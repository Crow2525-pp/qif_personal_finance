# ./dockerfile

FROM python:3.11-slim

# RUN rm /var/lib/postgresql/data
ARG DAGSTER_HOME
ARG DAGSTER_APP

ENV DAGSTER_HOME=${DAGSTER_HOME:-homenotset}
ENV DAGSTER_APP=${DAGSTER_APP:-appnotset}


# Create application directory
WORKDIR ${DAGSTER_APP}

COPY pyproject.toml ./

# Install the required dependencies
RUN pip install poetry
RUN poetry config virtualenvs.create false
RUN poetry install --only main


WORKDIR ${DAGSTER_APP}

# Create Dagster home directory
RUN mkdir -p ${DAGSTER_HOME}
COPY workspace.yaml dagster.yaml  ${DAGSTER_HOME}/
