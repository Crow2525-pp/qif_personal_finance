{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "text",
        "uid": "-- Text --"
      },
      "gridPos": {
        "h": 6,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 100,
      "options": {
        "content": "### Dashboard Guide\nCompare latest year against prior three years and focus on persistent trend shifts.",
        "mode": "markdown"
      },
      "pluginVersion": "10.0.0",
      "title": "Dashboard Guide",
      "type": "text"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Key financial metrics for the most recent complete year",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "annual_net_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 0
                    },
                    {
                      "color": "green",
                      "value": 10000
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_income"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Annual Income"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Annual Expenses"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "year_end_net_worth"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Year-End Net Worth"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 6
      },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  annual_income,\n  annual_expenses,\n  annual_net_cash_flow,\n  year_end_net_worth\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year = latest_year.max_year;",
          "refId": "A"
        }
      ],
      "title": "Latest Complete Year Overview",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Average metrics calculated from the previous 3 years (excluding most recent)",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "avg_annual_income"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg Income (3yr)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "avg_annual_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg Expenses (3yr)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "avg_net_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg Net Cash Flow (3yr)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "avg_net_worth_growth"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg Net Worth Growth (3yr)"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 6
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n),\nprevious_3_years AS (\n  SELECT *\n  FROM reporting.rpt_year_over_year_comparison, latest_year\n  WHERE comparison_year < latest_year.max_year\n  AND comparison_year >= (latest_year.max_year - 3)\n  ORDER BY comparison_year DESC\n  LIMIT 3\n)\nSELECT \n  ROUND(AVG(annual_income), 0) as avg_annual_income,\n  ROUND(AVG(annual_expenses), 0) as avg_annual_expenses,\n  ROUND(AVG(annual_net_cash_flow), 0) as avg_net_cash_flow,\n  ROUND(AVG(annual_net_worth_change), 0) as avg_net_worth_growth\nFROM previous_3_years;",
          "refId": "A"
        }
      ],
      "title": "Previous 3 Years Average",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Comparison between latest year and 3-year historical average",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "income_vs_3yr_avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Income vs 3yr Avg"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": -0.05
                    },
                    {
                      "color": "green",
                      "value": 0.05
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "expenses_vs_3yr_avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Expenses vs 3yr Avg"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 0.05
                    },
                    {
                      "color": "red",
                      "value": 0.15
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "net_cash_flow_vs_3yr_avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Cash Flow vs 3yr Avg"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": -0.1
                    },
                    {
                      "color": "green",
                      "value": 0.1
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "savings_rate_vs_3yr_avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Savings Rate vs 3yr Avg"
              },
              {
                "id": "unit",
                "value": "percentunit"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "comparison_years_used"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Years Included in Baseline"
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 14
      },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n),\nlatest_data AS (\n  SELECT *\n  FROM reporting.rpt_year_over_year_comparison, latest_year\n  WHERE comparison_year = latest_year.max_year\n),\nprevious_3_years AS (\n  SELECT *\n  FROM reporting.rpt_year_over_year_comparison, latest_year\n  WHERE comparison_year < latest_year.max_year\n  AND comparison_year >= (latest_year.max_year - 3)\n  ORDER BY comparison_year DESC\n  LIMIT 3\n),\navg_3_years AS (\n  SELECT \n    AVG(annual_income) as avg_income,\n    AVG(annual_expenses) as avg_expenses,\n    AVG(annual_net_cash_flow) as avg_net_cash_flow,\n    AVG(avg_annual_savings_rate) as avg_savings_rate,\n    COUNT(*) AS comparison_years_used\n  FROM previous_3_years\n)\nSELECT \n  CASE\n    WHEN NULLIF(avg_3_years.avg_income, 0) IS NULL THEN 0\n    ELSE (latest_data.annual_income - avg_3_years.avg_income) / avg_3_years.avg_income\n  END as income_vs_3yr_avg,\n  CASE\n    WHEN NULLIF(avg_3_years.avg_expenses, 0) IS NULL THEN 0\n    ELSE (latest_data.annual_expenses - avg_3_years.avg_expenses) / avg_3_years.avg_expenses\n  END as expenses_vs_3yr_avg,\n  CASE\n    WHEN NULLIF(ABS(avg_3_years.avg_net_cash_flow), 0) IS NULL THEN 0\n    ELSE (latest_data.annual_net_cash_flow - avg_3_years.avg_net_cash_flow) / ABS(avg_3_years.avg_net_cash_flow)\n  END as net_cash_flow_vs_3yr_avg,\n  COALESCE(latest_data.avg_annual_savings_rate - avg_3_years.avg_savings_rate, 0) as savings_rate_vs_3yr_avg,\n  avg_3_years.comparison_years_used\nFROM latest_data, avg_3_years;",
          "refId": "A"
        }
      ],
      "title": "Latest Year vs 3-Year Average Performance",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Four-year income and expense trends",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 3,
            "pointSize": 6,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "annual_income"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Annual Income"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Annual Expenses"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_net_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 22
      },
      "id": 4,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  (comparison_year || '-01-01')::date as time,\n  annual_income,\n  annual_expenses,\n  annual_net_cash_flow\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year >= (latest_year.max_year - 3)\nORDER BY comparison_year;",
          "refId": "A"
        }
      ],
      "title": "Four-Year Income vs Expenses Trend",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Net worth progression over four years",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 4,
            "pointSize": 8,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "year_end_net_worth"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Year-End Net Worth"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_net_worth_change"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Annual Net Worth Change"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "orange",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 22
      },
      "id": 5,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  (comparison_year || '-01-01')::date as time,\n  year_end_net_worth,\n  annual_net_worth_change\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year >= (latest_year.max_year - 3)\nORDER BY comparison_year;",
          "refId": "A"
        }
      ],
      "title": "Four-Year Net Worth Progression",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Savings rate comparison across four years",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "avg_annual_savings_rate"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Annual Savings Rate"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 30
      },
      "id": 6,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  (comparison_year || '-01-01')::date as time,\n  avg_annual_savings_rate\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year >= (latest_year.max_year - 3)\nORDER BY comparison_year;",
          "refId": "A"
        }
      ],
      "title": "Four-Year Savings Rate Comparison",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Expense category breakdown by year",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "normal"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "annual_mortgage_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Mortgage"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_household_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Household"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_food_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Food & Drink"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "orange",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "annual_family_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Family & Kids"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "yellow",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 30
      },
      "id": 7,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  (comparison_year || '-01-01')::date as time,\n  annual_mortgage_expenses,\n  annual_household_expenses,\n  annual_food_expenses,\n  annual_family_expenses\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year >= (latest_year.max_year - 3)\nORDER BY comparison_year;",
          "refId": "A"
        }
      ],
      "title": "Four-Year Expense Category Trends",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Inflation-adjusted four-year comparison",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 3,
            "pointSize": 6,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "inflation_adjusted_annual_income"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Inflation-Adjusted Income"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "inflation_adjusted_annual_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Inflation-Adjusted Expenses"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 38
      },
      "id": 9,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  (comparison_year || '-01-01')::date as time,\n  inflation_adjusted_annual_income,\n  inflation_adjusted_annual_expenses\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year >= (latest_year.max_year - 3)\nORDER BY comparison_year;",
          "refId": "A"
        }
      ],
      "title": "Four-Year Inflation-Adjusted Income vs Expenses",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Top 3 drivers comparison across four years",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 38
      },
      "id": 10,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  comparison_year as \"Year\",\n  top_expense_driver_1 as \"Top Expense\",\n  top_expense_driver_2 as \"2nd Expense\",\n  top_net_worth_driver_1 as \"Net Worth Driver\"\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year >= (latest_year.max_year - 3)\nORDER BY comparison_year DESC;",
          "refId": "A"
        }
      ],
      "title": "Four-Year Top 3 Drivers Comparison",
      "type": "table"
    },
    {
      "datasource": {
        "type": "text",
        "uid": "-- Text --"
      },
      "gridPos": {
        "h": 4,
        "w": 24,
        "x": 0,
        "y": 46
      },
      "id": 11,
      "options": {
        "content": "## Narrative Summary\nLatest year wins, risks, and next actions.",
        "mode": "markdown"
      },
      "pluginVersion": "10.0.0",
      "title": "Key Insights & Narrative",
      "type": "text"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Summary narrative of wins, risks, and next actions",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 24,
        "x": 0,
        "y": 50
      },
      "id": 12,
      "options": {
        "frameIndex": 0,
        "showHeader": false
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  narrative_summary as \"Summary\"\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year = latest_year.max_year;",
          "refId": "A"
        }
      ],
      "title": "Narrative Summary",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Comprehensive four-year financial summary table",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Income"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "colored-background"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Expenses"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Net Cash Flow"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "mode": "gradient",
                  "type": "gauge"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 0
                    },
                    {
                      "color": "green",
                      "value": 10000
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Year-End Net Worth"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Savings Rate %"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "mode": "gradient",
                  "type": "gauge"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 10
                    },
                    {
                      "color": "green",
                      "value": 20
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Total Savings"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 56
      },
      "id": 8,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest_year AS (\n  SELECT MAX(comparison_year) as max_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n)\nSELECT \n  comparison_year as \"Year\",\n  annual_income as \"Income\",\n  annual_expenses as \"Expenses\",\n  annual_net_cash_flow as \"Net Cash Flow\",\n  year_end_net_worth as \"Year-End Net Worth\",\n  ROUND(avg_annual_savings_rate * 100, 1) as \"Savings Rate %\",\n  annual_total_savings as \"Total Savings\",\n  months_positive_cash_flow as \"Positive Months\",\n  CASE \n    WHEN comparison_year = latest_year.max_year THEN 'â† Latest'\n    ELSE ''\n  END as \"Note\"\nFROM reporting.rpt_year_over_year_comparison, latest_year\nWHERE comparison_year >= (latest_year.max_year - 3)\nORDER BY comparison_year DESC;",
          "refId": "A"
        }
      ],
      "title": "Four-Year Financial Comparison Summary",
      "type": "table"
    },
    {
      "id": 101,
      "type": "table",
      "title": "Data Freshness",
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PCC52D03280B7034C"
      },
      "targets": [
        {
          "refId": "A",
          "format": "table",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PCC52D03280B7034C"
          },
          "rawQuery": true,
          "rawSql": "WITH latest_complete_year AS (\n  SELECT MAX(comparison_year) AS latest_year\n  FROM reporting.rpt_year_over_year_comparison\n  WHERE comparison_year < EXTRACT(YEAR FROM CURRENT_DATE)\n),\ncomparison_window AS (\n  SELECT COUNT(*) AS available_years\n  FROM reporting.rpt_year_over_year_comparison, latest_complete_year\n  WHERE comparison_year >= (latest_complete_year.latest_year - 3)\n    AND comparison_year <= latest_complete_year.latest_year\n)\nSELECT\n  COALESCE((SELECT latest_year::text FROM latest_complete_year), 'N/A') AS \"Latest Complete Year\",\n  COALESCE((SELECT available_years::text FROM comparison_window), '0') AS \"Years Included\",\n  CASE\n    WHEN COALESCE((SELECT available_years FROM comparison_window), 0) >= 4 THEN 'Full 4-year comparison'\n    WHEN COALESCE((SELECT available_years FROM comparison_window), 0) >= 2 THEN 'Partial comparison (fewer than 4 years)'\n    ELSE 'Insufficient history for full comparison'\n  END AS \"Completeness\",\n  COALESCE(to_char(MAX(report_generated_at), 'YYYY-MM-DD HH24:MI'), 'N/A') AS \"Last Refresh\"\nFROM reporting.rpt_year_over_year_comparison;"
        }
      ],
      "options": {
        "showHeader": true,
        "footer": {
          "show": false
        },
        "cellHeight": "sm"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "center"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 24,
        "x": 0,
        "y": 64
      }
    }
  ],
  "refresh": "",
  "schemaVersion": 39,
  "style": "dark",
  "tags": [
    "four-year",
    "comparison",
    "prior-year",
    "historical",
    "trends",
    "personal-finance",
    "dashboard"
  ],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-5y",
    "to": "now"
  },
  "timepicker": {
    "hidden": false,
    "quick_ranges": [
      {
        "from": "now-1M/M",
        "to": "now/M",
        "display": "Last complete month"
      },
      {
        "from": "now-3M/M",
        "to": "now/M",
        "display": "Last quarter"
      },
      {
        "from": "now/y",
        "to": "now",
        "display": "Year to date"
      },
      {
        "from": "now-12M/M",
        "to": "now/M",
        "display": "Trailing 12 months"
      },
      {
        "from": "now-5y",
        "to": "now",
        "display": "All time"
      }
    ]
  },
  "timezone": "",
  "title": "14 - Four-Year Financial Comparison",
  "uid": "four_year_financial_comparison",
  "version": 1,
  "weekStart": ""
}
