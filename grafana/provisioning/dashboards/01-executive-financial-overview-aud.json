{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Shows the time window of data included in this dashboard and when it was last refreshed. Times shown in local timezone (Australia/Melbourne). Data refreshes monthly when new transactions are processed. [Fixed to latest closed month (ignores time picker)]",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "id": 101,
      "options": {
        "cellHeight": "md",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nexec_view AS (\n  SELECT dashboard_generated_at\n  FROM reporting.rpt_executive_dashboard\n  WHERE dashboard_month = (SELECT month_key FROM selected_key)\n)\nSELECT\n  'Latest Month' AS \"Time Window\",\n  to_char((SELECT month_date FROM selected_period), 'Mon YYYY') AS \"Data Through\",\n  to_char(MAX(exec_view.dashboard_generated_at), 'YYYY-MM-DD HH24:MI') AS \"Last Refresh\"\nFROM exec_view;",
          "refId": "A"
        }
      ],
      "title": "Data Freshness",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "left",
            "cellOptions": {
              "type": "markdown"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 6,
        "y": 0,
        "w": 12,
        "h": 4
      },
      "id": 20,
      "options": {
        "cellHeight": "md",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": false
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\ncurrent_month AS (\n  SELECT net_cash_flow, total_income\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month = (SELECT month_key FROM selected_key)\n),\nforecast AS (\n  SELECT forecasted_next_month_net_flow\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n)\nSELECT CONCAT(\n  'Latest Month: ', to_char((SELECT month_date FROM selected_period), 'Mon YYYY'),\n  '<br/>Net Cash Flow: ', CASE WHEN cm.net_cash_flow >= 0 THEN '+$' ELSE '-$' END, ROUND(ABS(cm.net_cash_flow))::text,\n  '<br/>Savings Rate: ', ROUND((cm.net_cash_flow / NULLIF(cm.total_income, 0)) * 100, 1)::text, '%',\n  '<br/>Forecast (', to_char((SELECT month_date FROM selected_period) + INTERVAL '1 month', 'Mon YYYY'), '): ', CASE WHEN COALESCE(fc.forecasted_next_month_net_flow, 0) >= 0 THEN '+$' ELSE '-$' END, ROUND(ABS(COALESCE(fc.forecasted_next_month_net_flow, 0)))::text,\n  '<br/>Refreshed monthly, reviewed quarterly.'\n) AS summary\nFROM current_month cm\nLEFT JOIN forecast fc ON TRUE;",
          "refId": "A"
        }
      ],
      "title": "Executive Summary",
      "type": "table",
      "description": "One-line summary of latest financial position, forecast, and dashboard refresh cadence. [Fixed to latest closed month (ignores time picker)]"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Score 0-100 indicating expense management effectiveness. Higher scores mean better expense control relative to income. Low scores suggest overspending relative to earnings.",
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 100,
          "unit": "short",
          "links": [
            {
              "title": "View Savings Analysis Details",
              "url": "/d/savings_analysis",
              "targetBlank": true
            },
            {
              "title": "View Net Worth Dashboard",
              "url": "/d/household_net_worth",
              "targetBlank": true
            },
            {
              "title": "View Account Performance",
              "url": "/d/account_performance_dashboard",
              "targetBlank": true
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              },
              {
                "color": "yellow",
                "value": 50
              },
              {
                "color": "green",
                "value": 70
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Financial Health"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#32CD32",
                  "mode": "fixed"
                }
              },
              {
                "id": "displayName",
                "value": "Financial Health"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Savings Performance"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#FFD700",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Net Worth Progress"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#FF6347",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Cash Flow Status"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#1E90FF",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 0,
        "y": 14,
        "w": 12,
        "h": 5
      },
      "id": 6,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nwindow_budget AS (\n  SELECT\n    COALESCE(SUM(net_cash_flow), 0) AS total_net_cash_flow,\n    COALESCE(SUM(total_income), 0)  AS total_income\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN (SELECT start_date FROM window_range)\n        AND     (SELECT end_date   FROM window_range)\n),\ncurrent_cf AS (\n  SELECT cash_flow_status\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\ncurrent_nw AS (\n  SELECT wealth_milestone\n  FROM reporting.rpt_household_net_worth\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\nscores AS (\n  SELECT\n    CASE\n      WHEN NULLIF(wb.total_income, 0) IS NULL THEN 10\n      WHEN wb.total_net_cash_flow / wb.total_income >= 0.30 THEN 100\n      WHEN wb.total_net_cash_flow / wb.total_income >= 0.20 THEN 80\n      WHEN wb.total_net_cash_flow / wb.total_income >= 0.15 THEN 60\n      WHEN wb.total_net_cash_flow / wb.total_income >= 0.10 THEN 40\n      WHEN wb.total_net_cash_flow / wb.total_income >= 0.05 THEN 25\n      ELSE 10\n    END AS savings_score,\n    CASE coalesce(cnw.wealth_milestone, '')\n      WHEN 'High Net Worth'    THEN 100\n      WHEN 'Building Wealth'   THEN 80\n      WHEN 'Positive Net Worth' THEN 60\n      WHEN 'Rebuilding Phase'  THEN 40\n      WHEN 'Starting Out'      THEN 25\n      ELSE 40\n    END AS net_worth_score,\n    CASE coalesce(ccf.cash_flow_status, '')\n      WHEN 'Strong Positive' THEN 100\n      WHEN 'Positive'        THEN 80\n      WHEN 'Neutral'         THEN 60\n      WHEN 'Negative'        THEN 40\n      WHEN 'Critical'        THEN 20\n      ELSE 40\n    END AS cash_flow_score\n  FROM window_budget wb\n  LEFT JOIN current_cf ccf ON TRUE\n  LEFT JOIN current_nw cnw ON TRUE\n),\ncombined AS (\n  SELECT\n    ROUND(0.3 * COALESCE(net_worth_score, 0) + 0.3 * COALESCE(savings_score, 0) + 0.4 * COALESCE(cash_flow_score, 0)) AS financial_health,\n    savings_score,\n    net_worth_score,\n    cash_flow_score\n  FROM scores\n)\nSELECT financial_health AS \"Financial Health\",\n       savings_score AS \"Savings Performance\",\n       net_worth_score AS \"Net Worth Progress\",\n       cash_flow_score AS \"Cash Flow Status\"\nFROM combined;",
          "refId": "A"
        }
      ],
      "title": "Financial Health Scores",
      "transformations": [],
      "type": "bargauge"
    },
    {
      "id": 11,
      "title": "Key Executive KPIs",
      "type": "table",
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "gridPos": {
        "x": 0,
        "y": 19,
        "w": 12,
        "h": 6
      },
      "options": {
        "cellHeight": "md",
        "showHeader": true
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "left"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "metric"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Metric"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "current_value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Current ($)"
              },
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "previous_value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Previous ($)"
              },
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "delta_value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Delta ($)"
              },
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "delta_ratio"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Delta Ratio"
              },
              {
                "id": "unit",
                "value": "percentunit"
              },
              {
                "id": "custom",
                "value": {
                  "align": "left",
                  "displayMode": "color-text",
                  "nullTextValue": "n/a"
                }
              }
            ]
          }
        ]
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nprevious_window_range AS (\n  SELECT\n    ((SELECT start_date FROM window_range) - INTERVAL '1 month')::date AS start_date,\n    ((SELECT end_date   FROM window_range) - INTERVAL '1 month')::date AS end_date\n),\ncurrent_budget AS (\n  SELECT COALESCE(SUM(net_cash_flow), 0) AS net_cash_flow\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN (SELECT start_date FROM window_range)\n        AND     (SELECT end_date   FROM window_range)\n),\nprevious_budget AS (\n  SELECT COALESCE(SUM(net_cash_flow), 0) AS net_cash_flow\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN (SELECT start_date FROM previous_window_range)\n        AND     (SELECT end_date   FROM previous_window_range)\n),\ncurrent_cf AS (\n  SELECT forecasted_next_month_net_flow\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\nprevious_cf AS (\n  SELECT forecasted_next_month_net_flow\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT end_date FROM previous_window_range)\n)\nSELECT 'Net Cash Flow' AS metric,\n       cb.net_cash_flow AS current_value,\n       COALESCE(pb.net_cash_flow, cb.net_cash_flow) AS previous_value,\n       cb.net_cash_flow - COALESCE(pb.net_cash_flow, 0) AS delta_value,\n       CASE\n         WHEN COALESCE(pb.net_cash_flow, 0) = 0 AND COALESCE(cb.net_cash_flow, 0) = 0 THEN 0\n         WHEN COALESCE(pb.net_cash_flow, 0) = 0 THEN NULL\n         ELSE (cb.net_cash_flow - COALESCE(pb.net_cash_flow, 0)) / NULLIF(ABS(pb.net_cash_flow), 0)\n       END AS delta_ratio\nFROM current_budget cb LEFT JOIN previous_budget pb ON TRUE\nUNION ALL\nSELECT 'Forecast (Next Month)' AS metric,\n       ccf.forecasted_next_month_net_flow,\n       COALESCE(pcf.forecasted_next_month_net_flow, ccf.forecasted_next_month_net_flow),\n       ccf.forecasted_next_month_net_flow - COALESCE(pcf.forecasted_next_month_net_flow, 0),\n       CASE\n         WHEN COALESCE(pcf.forecasted_next_month_net_flow, 0) = 0 AND COALESCE(ccf.forecasted_next_month_net_flow, 0) = 0 THEN 0\n         WHEN COALESCE(pcf.forecasted_next_month_net_flow, 0) = 0 THEN NULL\n         ELSE (ccf.forecasted_next_month_net_flow - COALESCE(pcf.forecasted_next_month_net_flow, 0)) / NULLIF(ABS(pcf.forecasted_next_month_net_flow), 0)\n       END\nFROM current_cf ccf LEFT JOIN previous_cf pcf ON TRUE;",
          "refId": "A"
        }
      ],
      "description": "Current = Latest closed month, Previous = Prior month. Month-over-month comparison of key executive metrics. Current = latest closed month, Previous = prior month, Delta = change amount, Delta Ratio = percentage change. Focus on large negative deltas for attention areas."
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Key financial metrics for the latest closed month: income, expenses, net cash flow, savings, net worth, and liquid assets. Targets: Savings Rate > 10%, Expense Ratio < 90%.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic-by-name"
          },
          "custom": {
            "displayMode": "basic",
            "minVizHeight": 10,
            "minVizWidth": 0,
            "orientation": "horizontal",
            "showUnfilled": true,
            "width": 0.6
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "#8B0000",
                "value": null
              },
              {
                "color": "#CD853F",
                "value": 5
              },
              {
                "color": "#DAA520",
                "value": 10
              },
              {
                "color": "#FFD700",
                "value": 20
              },
              {
                "color": "#32CD32",
                "value": 30
              }
            ]
          },
          "unit": "percent",
          "min": 0,
          "max": 100,
          "links": [
            {
              "title": "View Savings Analysis Details",
              "url": "/d/savings_analysis",
              "targetBlank": true
            },
            {
              "title": "View Expense Performance Details",
              "url": "/d/expense_performance",
              "targetBlank": true
            },
            {
              "title": "View Cash Flow Analysis",
              "url": "/d/cash_flow_analysis",
              "targetBlank": true
            }
          ]
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Savings Rate (Monthly)"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#FF6B35",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Savings Rate (3M Avg)"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#F7931E",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Savings Rate (YTD)"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#FFD23F",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Expense Ratio (%)"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "#32CD32",
                      "value": null
                    },
                    {
                      "color": "#FFD700",
                      "value": 80
                    },
                    {
                      "color": "#FF8C00",
                      "value": 100
                    },
                    {
                      "color": "#8B0000",
                      "value": 110
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 12,
        "y": 14,
        "w": 12,
        "h": 5
      },
      "id": 3,
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "showThresholdLabels": true,
        "showThresholdMarkers": true,
        "orientation": "horizontal"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nwindow_budget AS (\n  SELECT\n    COALESCE(SUM(net_cash_flow), 0)   AS total_net_cash_flow,\n    COALESCE(SUM(total_income), 0)    AS total_income,\n    COALESCE(SUM(total_expenses), 0)  AS total_expenses\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN (SELECT start_date FROM window_range)\n        AND     (SELECT end_date   FROM window_range)\n),\nytd_budget AS (\n  SELECT\n    COALESCE(SUM(net_cash_flow), 0) AS ytd_net,\n    COALESCE(SUM(total_income), 0)  AS ytd_income\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN DATE_TRUNC('year', (SELECT end_date FROM window_range))\n        AND     (SELECT end_date FROM window_range)\n),\ntrailing_3m AS (\n  SELECT\n    COALESCE(SUM(net_cash_flow), 0) AS t3_net,\n    COALESCE(SUM(total_income), 0)  AS t3_income\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN (SELECT end_date FROM window_range) - INTERVAL '2 months'\n        AND     (SELECT end_date FROM window_range)\n)\nSELECT 'Savings Rate (Monthly)' AS metric_label,\n       ROUND(CASE WHEN NULLIF(wb.total_income, 0) IS NOT NULL\n                  THEN wb.total_net_cash_flow / wb.total_income * 100 ELSE 0 END, 1) AS value\nFROM window_budget wb\nUNION ALL\nSELECT 'Savings Rate (3M Avg)',\n       ROUND(CASE WHEN NULLIF(t3.t3_income, 0) IS NOT NULL\n                  THEN t3.t3_net / t3.t3_income * 100 ELSE 0 END, 1)\nFROM trailing_3m t3\nUNION ALL\nSELECT 'Savings Rate (YTD)',\n       ROUND(CASE WHEN NULLIF(yb.ytd_income, 0) IS NOT NULL\n                  THEN yb.ytd_net / yb.ytd_income * 100 ELSE 0 END, 1)\nFROM ytd_budget yb\nUNION ALL\nSELECT 'Expense Ratio (%)',\n       ROUND(CASE WHEN NULLIF(wb.total_income, 0) IS NOT NULL\n                  THEN wb.total_expenses / wb.total_income * 100 ELSE 0 END, 1)\nFROM window_budget wb;",
          "refId": "A"
        }
      ],
      "title": "Savings & Expense Performance",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "indexByName": {
              "metric_label": 0,
              "value": 1
            },
            "renameByName": {}
          }
        },
        {
          "id": "groupBy",
          "options": {
            "fields": {
              "metric_label": {
                "aggregations": [],
                "operation": "groupby"
              },
              "value": {
                "aggregations": [
                  "lastNotNull"
                ],
                "operation": "aggregate"
              }
            }
          }
        }
      ],
      "type": "bargauge"
    },
    {
      "id": 102,
      "title": "Health & Risk KPIs",
      "type": "table",
      "gridPos": {
        "x": 12,
        "y": 19,
        "w": 12,
        "h": 6
      },
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nprevious_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n  WHERE month_date < (SELECT month_date FROM selected_period)\n),\ncurrent_nw AS (\n  SELECT net_worth_health_score\n  FROM reporting.rpt_household_net_worth\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\nprevious_nw AS (\n  SELECT net_worth_health_score\n  FROM reporting.rpt_household_net_worth\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM previous_period)\n),\ncurrent_alerts AS (\n  SELECT COALESCE(COUNT(*) FILTER (WHERE needs_attention_flag), 0) AS accounts_at_risk\n  FROM reporting.rpt_account_performance\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\nprevious_alerts AS (\n  SELECT COALESCE(COUNT(*) FILTER (WHERE needs_attention_flag), 0) AS accounts_at_risk\n  FROM reporting.rpt_account_performance\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM previous_period)\n)\nSELECT 'Net Worth Health Score' AS metric,\n       cnw.net_worth_health_score AS current_value,\n       COALESCE(pnw.net_worth_health_score, cnw.net_worth_health_score) AS previous_value,\n       cnw.net_worth_health_score - COALESCE(pnw.net_worth_health_score, 0) AS delta_value,\n       CASE WHEN COALESCE(pnw.net_worth_health_score, 0) = 0 THEN NULL\n            ELSE (cnw.net_worth_health_score - COALESCE(pnw.net_worth_health_score, 0))::numeric / NULLIF(ABS(pnw.net_worth_health_score)::numeric, 0)\n       END AS delta_ratio\nFROM current_nw cnw LEFT JOIN previous_nw pnw ON TRUE\nUNION ALL\nSELECT 'Accounts At Risk' AS metric,\n       ca.accounts_at_risk::double precision,\n       COALESCE(pa.accounts_at_risk, ca.accounts_at_risk)::double precision,\n       (ca.accounts_at_risk - COALESCE(pa.accounts_at_risk, 0))::double precision,\n       CASE WHEN COALESCE(pa.accounts_at_risk, 0) = 0 AND COALESCE(ca.accounts_at_risk, 0) = 0 THEN 0\n            WHEN COALESCE(pa.accounts_at_risk, 0) = 0 THEN NULL\n            ELSE (ca.accounts_at_risk - COALESCE(pa.accounts_at_risk, 0))::double precision / NULLIF(ABS(pa.accounts_at_risk)::double precision, 0)\n       END AS delta_ratio\nFROM current_alerts ca LEFT JOIN previous_alerts pa ON TRUE;",
          "refId": "A"
        }
      ],
      "options": {
        "cellHeight": "sm",
        "showHeader": true
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "left"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "metric"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Metric"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "current_value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Current"
              },
              {
                "id": "unit",
                "value": "none"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "previous_value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Previous"
              },
              {
                "id": "unit",
                "value": "none"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "delta_value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Delta"
              },
              {
                "id": "unit",
                "value": "none"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "delta_ratio"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Delta Ratio"
              },
              {
                "id": "unit",
                "value": "percentunit"
              },
              {
                "id": "custom",
                "value": {
                  "align": "left",
                  "displayMode": "color-text",
                  "nullTextValue": "n/a"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Delta Ratio"
            },
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "auto"
                }
              },
              {
                "id": "custom.nullTextValue",
                "value": "n/a"
              }
            ]
          }
        ]
      },
      "description": "Current = Latest closed month, Previous = Prior month. Score and risk KPIs expressed as raw values; Delta Ratio captures relative change where applicable. Net Worth Health Score (0-100): Measures overall financial health. Accounts At Risk (count): Number of accounts with concerning patterns."
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Savings rate and expense ratio trends. Savings Rate: percent of income saved. Expense Ratio: expenses as percent of income. Lower expense ratio and higher savings rate are better. Monthly, 3-month average, and year-to-date views show trend consistency. Scale: 0-100 (higher is better). Calculated based on expense volatility, budget adherence, and savings consistency. [Fixed to latest closed month]",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic-by-name"
          },
          "custom": {
            "displayMode": "basic",
            "minVizHeight": 10,
            "minVizWidth": 0,
            "orientation": "horizontal",
            "showUnfilled": true,
            "width": 0.8
          },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "#8B0000",
                "value": 0
              },
              {
                "color": "#FF4500",
                "value": 30
              },
              {
                "color": "#FFD700",
                "value": 60
              },
              {
                "color": "#32CD32",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Expense Control Score"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#EE4B6A",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "id": 12,
      "title": "Expense Control Score",
      "type": "stat",
      "gridPos": {
        "x": 16,
        "y": 10,
        "w": 8,
        "h": 4
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "value_and_name",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center"
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nwindow_cf AS (\n  SELECT\n    COALESCE(SUM(total_outflows), 0) AS total_outflows,\n    COALESCE(SUM(total_inflows), 0)  AS total_inflows\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN (SELECT start_date FROM window_range)\n        AND     (SELECT end_date   FROM window_range)\n)\nSELECT CASE\n         WHEN NULLIF(wcf.total_inflows, 0) IS NULL            THEN 40\n         WHEN wcf.total_outflows / wcf.total_inflows <= 0.80  THEN 95\n         WHEN wcf.total_outflows / wcf.total_inflows <= 0.90  THEN 85\n         WHEN wcf.total_outflows / wcf.total_inflows <= 1.00  THEN 70\n         WHEN wcf.total_outflows / wcf.total_inflows <= 1.10  THEN 55\n         WHEN wcf.total_outflows / wcf.total_inflows <= 1.25  THEN 40\n         WHEN wcf.total_outflows / wcf.total_inflows <= 1.50  THEN 25\n         ELSE 10\n       END AS \"Expense Control Score\"\nFROM window_cf wcf;",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Shows latest monthly income, expenses, net cash flow, net worth, and liquid assets for executive review. For month-over-month trends, see Cash Flow Trend panel below. Values reflect the selected time range; when set to multiple months, totals are summed across the period.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "#B7950B",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD",
          "links": [
            {
              "title": "View Monthly Budget Summary",
              "url": "/d/monthly_budget_summary",
              "targetBlank": true
            },
            {
              "title": "View Cash Flow Analysis",
              "url": "/d/cash_flow_analysis",
              "targetBlank": true
            },
            {
              "title": "View Net Worth Details",
              "url": "/d/household_net_worth",
              "targetBlank": true
            }
          ]
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "monthly_income"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Monthly Income"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#32CD32",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "monthly_expenses"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Monthly Expenses"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#DC143C",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "monthly_net_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "#8B0000",
                      "value": null
                    },
                    {
                      "color": "#FFD700",
                      "value": -1000
                    },
                    {
                      "color": "#32CD32",
                      "value": 0
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "current_net_worth"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Worth"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "#8B0000",
                      "value": null
                    },
                    {
                      "color": "#FFD700",
                      "value": -100000
                    },
                    {
                      "color": "#32CD32",
                      "value": 0
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "liquid_assets"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Liquid Assets"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#00CED1",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 0,
        "y": 4,
        "w": 24,
        "h": 6
      },
      "id": 5,
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nwindow_cf AS (\n  SELECT\n    COALESCE(SUM(total_inflows), 0)  AS total_inflows,\n    COALESCE(SUM(total_outflows), 0) AS total_outflows,\n    COALESCE(SUM(net_cash_flow), 0)  AS net_cash_flow\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD')\n        BETWEEN (SELECT start_date FROM window_range)\n        AND     (SELECT end_date   FROM window_range)\n),\ncurrent_nw AS (\n  SELECT net_worth, liquid_assets\n  FROM reporting.rpt_household_net_worth\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n)\nSELECT\n  ROUND(COALESCE(wcf.total_inflows,  0), 2) AS monthly_income,\n  ROUND(COALESCE(wcf.total_outflows, 0), 2) AS monthly_expenses,\n  ROUND(COALESCE(wcf.net_cash_flow,  0), 2) AS monthly_net_cash_flow,\n  ROUND(COALESCE(cnw.net_worth,      0), 2) AS current_net_worth,\n  ROUND(COALESCE(cnw.liquid_assets,  0), 2) AS liquid_assets\nFROM window_cf wcf\nLEFT JOIN current_nw cnw ON TRUE;",
          "refId": "A"
        }
      ],
      "title": "Monthly Financial Snapshot",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "12-month cash flow history with 3-month moving average and next-month forecast. Shows seasonal patterns and trend direction. Use the time picker to extend the view beyond 12 months for longer-term analysis.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "#8B0000",
                "value": null
              },
              {
                "color": "#FFD700",
                "value": -5000
              },
              {
                "color": "#32CD32",
                "value": 0
              }
            ]
          },
          "unit": "currencyUSD",
          "links": [
            {
              "title": "View Cash Flow Analysis",
              "url": "/d/cash_flow_analysis",
              "targetBlank": true
            },
            {
              "title": "View Monthly Budget Summary",
              "url": "/d/monthly_budget_summary",
              "targetBlank": true
            }
          ],
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "spanNulls": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Net Cash Flow"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#32CD32",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.drawStyle",
                "value": "bars"
              },
              {
                "id": "custom.lineWidth",
                "value": 0
              },
              {
                "id": "custom.fillOpacity",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "3-Month Avg"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#4169E1",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.drawStyle",
                "value": "line"
              },
              {
                "id": "custom.lineWidth",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Forecast Next Month"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#FF6347",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.drawStyle",
                "value": "line"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              },
              {
                "id": "custom.lineWidth",
                "value": 2
              },
              {
                "id": "custom.fillOpacity",
                "value": 10
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 12,
        "y": 25,
        "w": 12,
        "h": 7
      },
      "id": 9,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "calcs": [
            "lastNotNull"
          ]
        },
        "tooltip": {
          "mode": "single"
        },
        "showPoints": "never"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\ncash_history AS (\n  SELECT to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date,\n         net_cash_flow\n  FROM reporting.rpt_monthly_budget_summary\n),\ncash_with_avg AS (\n  SELECT month_date,\n         net_cash_flow,\n         AVG(net_cash_flow) OVER (ORDER BY month_date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS avg_3m\n  FROM cash_history\n),\nforecast_history AS (\n  SELECT to_date(budget_year_month || '-01', 'YYYY-MM-DD') + interval '1 month' AS forecast_date,\n         forecasted_next_month_net_flow\n  FROM reporting.rpt_cash_flow_analysis\n),\nlookback_start AS (\n  SELECT (SELECT end_date FROM window_range) - INTERVAL '11 months' AS start_date\n),\nwindowed AS (\n  SELECT c.month_date,\n         c.net_cash_flow,\n         c.avg_3m\n  FROM cash_with_avg c\n  WHERE c.month_date >= (SELECT start_date FROM lookback_start)\n    AND c.month_date <= (SELECT month_date FROM selected_period)\n),\nforecast_windowed AS (\n  SELECT f.forecast_date,\n         f.forecasted_next_month_net_flow\n  FROM forecast_history f\n  WHERE f.forecast_date >= (SELECT start_date FROM lookback_start)\n    AND f.forecast_date <= (SELECT month_date FROM selected_period) + interval '1 month'\n)\nSELECT month_date AS \"time\",\n       net_cash_flow AS \"Net Cash Flow\",\n       avg_3m AS \"3-Month Avg\",\n       NULL::numeric AS \"Forecast Next Month\"\nFROM windowed\nUNION ALL\nSELECT forecast_date AS \"time\",\n       NULL::numeric AS \"Net Cash Flow\",\n       NULL::numeric AS \"3-Month Avg\",\n       forecasted_next_month_net_flow AS \"Forecast Next Month\"\nFROM forecast_windowed\nORDER BY \"time\";",
          "refId": "A"
        }
      ],
      "title": "Cash Flow Trend (12 Months)",
      "type": "timeseries",
      "timeFrom": "now-12M",
      "timeTo": "now"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Total assets, total liabilities, net worth, and debt-to-asset ratio. Net Worth = Assets - Liabilities. Lower debt-to-asset ratio is better. Monitor net worth growth and debt reduction progress. Shows current balances as of latest month. For trends over time, see Account Performance dashboard.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "#B7950B",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD",
          "links": [
            {
              "title": "View Net Worth Details",
              "url": "/d/household_net_worth",
              "targetBlank": true
            },
            {
              "title": "View Account Performance",
              "url": "/d/account_performance_dashboard",
              "targetBlank": true
            }
          ]
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "total_assets"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Total Assets"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#32CD32",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "total_liabilities"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Total Liabilities"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#DC143C",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "current_net_worth"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Worth"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "#8B0000",
                      "value": null
                    },
                    {
                      "color": "#FFD700",
                      "value": -100000
                    },
                    {
                      "color": "#32CD32",
                      "value": 0
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "debt_to_asset_ratio_percent"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Debt-to-Asset Ratio"
              },
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "#32CD32",
                      "value": null
                    },
                    {
                      "color": "#FFD700",
                      "value": 30
                    },
                    {
                      "color": "#FF4500",
                      "value": 50
                    },
                    {
                      "color": "#8B0000",
                      "value": 80
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 0,
        "y": 25,
        "w": 12,
        "h": 7
      },
      "id": 8,
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nselected_month AS (\n  SELECT COALESCE(\n    (\n      SELECT MAX(month_date)\n      FROM available_months am\n      WHERE am.month_date BETWEEN date_trunc('month', (SELECT start_date FROM window_range))\n                               AND (SELECT end_date FROM window_range)\n    ),\n    (SELECT MAX(month_date) FROM available_months)\n  ) AS month_date\n),\ncurrent_nw AS (\n  SELECT total_assets, total_liabilities, net_worth, debt_to_asset_ratio\n  FROM reporting.rpt_household_net_worth\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_month)\n)\nSELECT\n  ROUND(total_assets, 2) AS total_assets,\n  ROUND(total_liabilities, 2) AS total_liabilities,\n  ROUND(net_worth, 2) AS current_net_worth,\n  ROUND(debt_to_asset_ratio * 100, 1) AS debt_to_asset_ratio_percent\nFROM current_nw;",
          "refId": "A"
        }
      ],
      "title": "Asset & Liability Snapshot",
      "type": "stat"
    },
    {
      "id": 13,
      "title": "Cash Flow Drivers (Month-over-Month)",
      "type": "barchart",
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "gridPos": {
        "x": 0,
        "y": 32,
        "w": 12,
        "h": 6
      },
      "options": {
        "barRadius": 0,
        "barWidth": 0.6,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "hidden",
          "placement": "bottom",
          "showLegend": false
        },
        "orientation": "horizontal",
        "showValue": "never",
        "stacking": {
          "group": "A",
          "mode": "none"
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xField": "driver",
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "dashes"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "current_income"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "previous_income"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": true,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT DISTINCT\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_mom_cash_flow_waterfall\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nselected_month AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months am\n     WHERE am.month_date <= (SELECT end_date FROM window_range)),\n    (SELECT MAX(month_date) FROM available_months)\n  ) AS month_date\n)\nSELECT\n  driver,\n  delta_amount,\n  current_income,\n  previous_income\nFROM reporting.rpt_mom_cash_flow_waterfall\nWHERE budget_year_month = to_char((SELECT month_date FROM selected_month), 'YYYY-MM')\nORDER BY sort_order;",
          "refId": "A"
        }
      ],
      "description": "Month-over-month breakdown of income, expenses, transfers, and net cash flow drivers."
    },
    {
      "id": 103,
      "title": "Month-over-Month Rate Changes",
      "type": "bargauge",
      "gridPos": {
        "x": 12,
        "y": 32,
        "w": 12,
        "h": 6
      },
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT DISTINCT\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nselected_month AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months am\n     WHERE am.month_date <= (SELECT end_date FROM window_range)),\n    (SELECT MAX(month_date) FROM available_months)\n  ) AS month_date\n),\nprevious_month AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months am\n     WHERE am.month_date < (SELECT month_date FROM selected_month)),\n    (SELECT month_date FROM selected_month)\n  ) AS month_date\n),\ncurrent_budget AS (\n  SELECT COALESCE(MAX(savings_rate_percent), 0) AS savings_rate_percent\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_month)\n),\nprevious_budget AS (\n  SELECT COALESCE(MAX(savings_rate_percent), 0) AS savings_rate_percent\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM previous_month)\n),\ncurrent_cf AS (\n  SELECT COALESCE(MAX(outflow_to_inflow_ratio), 0) AS outflow_to_inflow_ratio\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_month)\n),\nprevious_cf AS (\n  SELECT COALESCE(MAX(outflow_to_inflow_ratio), 0) AS outflow_to_inflow_ratio\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM previous_month)\n)\nSELECT 'Savings Rate' AS metric,\n       cb.savings_rate_percent * 100 AS current_value,\n       COALESCE(pb.savings_rate_percent, cb.savings_rate_percent) * 100 AS previous_value,\n       (cb.savings_rate_percent - COALESCE(pb.savings_rate_percent, 0)) * 100 AS delta_value,\n       CASE\n         WHEN COALESCE(pb.savings_rate_percent, 0) = 0 AND COALESCE(cb.savings_rate_percent, 0) = 0 THEN 0\n         WHEN COALESCE(pb.savings_rate_percent, 0) = 0 THEN NULL\n         ELSE (cb.savings_rate_percent - COALESCE(pb.savings_rate_percent, 0)) / NULLIF(ABS(pb.savings_rate_percent), 0)\n       END AS delta_ratio\nFROM current_budget cb LEFT JOIN previous_budget pb ON TRUE\nUNION ALL\nSELECT 'Expense Ratio' AS metric,\n       ccf.outflow_to_inflow_ratio * 100 AS current_value,\n       COALESCE(pcf.outflow_to_inflow_ratio, ccf.outflow_to_inflow_ratio) * 100 AS previous_value,\n       (ccf.outflow_to_inflow_ratio - COALESCE(pcf.outflow_to_inflow_ratio, 0)) * 100 AS delta_value,\n       CASE\n         WHEN COALESCE(pcf.outflow_to_inflow_ratio, 0) = 0 AND COALESCE(ccf.outflow_to_inflow_ratio, 0) = 0 THEN 0\n         WHEN COALESCE(pcf.outflow_to_inflow_ratio, 0) = 0 THEN NULL\n         ELSE (ccf.outflow_to_inflow_ratio - COALESCE(pcf.outflow_to_inflow_ratio, 0)) / NULLIF(ABS(pcf.outflow_to_inflow_ratio), 0)\n       END AS delta_ratio\nFROM current_cf ccf LEFT JOIN previous_cf pcf ON TRUE;",
          "refId": "A"
        }
      ],
      "options": {
        "orientation": "horizontal",
        "displayMode": "basic",
        "showUnfilled": true,
        "minVizWidth": 0,
        "minVizHeight": 10,
        "namePlacement": "left",
        "valueMode": "text"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "red"
              },
              {
                "value": -10,
                "color": "orange"
              },
              {
                "value": 0,
                "color": "yellow"
              },
              {
                "value": 10,
                "color": "green"
              }
            ]
          },
          "custom": {}
        },
        "overrides": []
      },
      "description": "Current = Latest closed month, Previous = Prior month. Rate metrics on a 0-100 percent scale. Delta Ratio remains a raw ratio for relative change."
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Financial health metrics scored 0-100. Financial Health: overall composite score. Savings Performance: savings rate vs target. Net Worth Progress: growth trajectory. Cash Flow Status: income/expense balance. Higher scores indicate better financial health. Use these to prioritize improvement areas. Accounts are flagged when they show concerning patterns: negative trends, approaching limits, or unusual activity. Priority recommendation is based on current financial patterns and opportunities for optimization.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "#B7950B",
                "value": null
              }
            ]
          },
          "links": [
            {
              "title": "View Full Executive Dashboard",
              "url": "/d/executive_dashboard",
              "targetBlank": true
            }
          ]
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 49,
        "w": 24,
        "h": 4
      },
      "id": 7,
      "options": {
        "cellHeight": "sm",
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nexec_view AS (\n  SELECT *\n  FROM reporting.rpt_executive_dashboard\n  WHERE dashboard_month = (SELECT month_key FROM selected_key)\n)\nSELECT COALESCE(ev.priority_recommendation, 'No recommendation available for this period.') AS \"Priority Recommendation\",\n       COALESCE(NULLIF(ev.accounts_with_issues, ''), 'None flagged') AS \"Accounts Needing Attention\"\nFROM exec_view ev\nUNION ALL\nSELECT 'No recommendation available for this period.' AS \"Priority Recommendation\", 'None flagged' AS \"Accounts Needing Attention\"\nWHERE NOT EXISTS (SELECT 1 FROM exec_view);",
          "refId": "A"
        }
      ],
      "title": "AI Financial Insights",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Month-over-month changes in Income, Expenses, Transfers, and Net Change. Positive values (right) = increase, negative values (left) = decrease. Shows which categories are driving cash flow changes. Helps identify what's improving or degrading your financial position.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "left"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "#1E90FF",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 53,
        "w": 24,
        "h": 6
      },
      "id": 10,
      "options": {
        "cellHeight": "sm",
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nselected_key AS (\n  SELECT to_char(month_date, 'YYYY-MM') AS month_key\n  FROM selected_period\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\ncurrent_cf AS (\n  SELECT cash_flow_status\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\ncurrent_nw AS (\n  SELECT wealth_milestone\n  FROM reporting.rpt_household_net_worth\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\naccount_alerts AS (\n  SELECT COALESCE(COUNT(*) FILTER (WHERE needs_attention_flag), 0) AS accounts_needing_attention\n  FROM reporting.rpt_account_performance\n  WHERE to_date(budget_year_month || '-01', 'YYYY-MM-DD') = (SELECT month_date FROM selected_period)\n),\nexec_view AS (\n  SELECT *\n  FROM reporting.rpt_executive_dashboard\n  WHERE dashboard_month = (SELECT month_key FROM selected_key)\n)\nSELECT 'Overall Rating' AS \"Signal\", COALESCE(ev.overall_financial_health_rating, 'n/a') AS \"Status\", 'Composite of savings, cash flow, and net worth signals.' AS \"Explanation\"\nFROM exec_view ev\nUNION ALL\nSELECT 'Savings Tier', COALESCE(ev.current_savings_tier, 'n/a'), 'Benchmark category for latest savings rate.'\nFROM exec_view ev\nUNION ALL\nSELECT 'Cash Flow Status', COALESCE(ccf.cash_flow_status, 'n/a'), 'Health of current month cash flow vs historical pattern.'\nFROM current_cf ccf\nUNION ALL\nSELECT 'Net Worth Phase', COALESCE(cnw.wealth_milestone, 'n/a'), 'Stage of wealth-building progress based on assets and liabilities.'\nFROM current_nw cnw\nUNION ALL\nSELECT 'Accounts Requiring Attention', COALESCE(CAST(aa.accounts_needing_attention AS TEXT), '0'), 'Number of accounts flagged for manual review.'\nFROM account_alerts aa;",
          "refId": "A"
        }
      ],
      "title": "Status Highlights",
      "transformations": [],
      "type": "table"
    },
    {
      "datasource": {
        "type": "text"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "x": 18,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "id": 100,
      "options": {
        "content": "### How to Read\nUse the time picker, review top KPIs, then drill into linked panels for root causes.",
        "mode": "markdown"
      },
      "pluginVersion": "10.0.0",
      "title": "How to Read This Dashboard",
      "type": "text",
      "description": "Quick guide to interpreting the dashboard panels, metrics, and time controls."
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Data quality issues requiring attention. Stale accounts: no recent transactions. Unmatched transfers: transfers without matching counterparty. Uncategorized spend: transactions without categories. High uncategorized % reduces insight accuracy. Percentages represent the share of total transaction spend (not count) affected by each data quality issue. Next steps: Click issue names to drill down. Prioritize uncategorized transactions for categorization. [Reflects selected time range]",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left"
          },
          "links": [
            {
              "title": "View Outflows Reconciliation Exceptions",
              "url": "/d/outflows_reconciliation",
              "targetBlank": true
            }
          ]
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 140
              },
              {
                "id": "links",
                "value": [
                  {
                    "title": "View Uncategorized Transactions",
                    "url": "/d/transaction_analysis_dashboard",
                    "targetBlank": true
                  }
                ]
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Detail"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 240
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 0,
        "y": 43,
        "w": 12,
        "h": 6
      },
      "id": 901,
      "options": {
        "cellHeight": "md",
        "showHeader": true
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day')) ),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nperiod_bounds AS (\n  SELECT (SELECT start_date FROM window_range) AS window_start,\n         (SELECT end_date   FROM window_range) AS window_end,\n         ((SELECT end_date FROM window_range) + INTERVAL '1 month' - INTERVAL '1 day')::date AS window_end_day\n),\nstale_accounts AS (\n  SELECT COUNT(*) AS stale_accounts\n  FROM reporting.dim_accounts_enhanced\n  WHERE account_last_transaction_date < (SELECT window_end_day FROM period_bounds) - INTERVAL '45 days'\n),\ntransfer_pairs AS (\n  SELECT\n    transaction_date::date AS txn_date,\n    transaction_amount_abs AS amount_abs,\n    SUM(CASE WHEN transaction_amount < 0 THEN 1 ELSE 0 END) AS out_count,\n    SUM(CASE WHEN transaction_amount > 0 THEN 1 ELSE 0 END) AS in_count\n  FROM reporting.fct_transactions_enhanced\n  WHERE COALESCE(is_internal_transfer, FALSE)\n    AND transaction_date >= (SELECT window_start FROM period_bounds)\n    AND transaction_date <= (SELECT window_end_day FROM period_bounds)\n  GROUP BY 1,2\n),\nunmatched_transfers AS (\n  SELECT COALESCE(SUM(ABS(out_count - in_count)), 0) AS unmatched_count\n  FROM transfer_pairs\n),\nuncategorized AS (\n  SELECT\n    COALESCE(SUM(uncategorized_amount), 0) AS uncategorized_amount,\n    CASE\n      WHEN COALESCE(SUM(total_outflows), 0) > 0\n      THEN (COALESCE(SUM(uncategorized_amount), 0) / SUM(total_outflows)) * 100\n      ELSE 0\n    END AS uncategorized_pct\n  FROM reporting.rpt_outflows_insights_dashboard_compat\n  WHERE period_date BETWEEN (SELECT window_start FROM period_bounds)\n                        AND (SELECT window_end   FROM period_bounds)\n)\nSELECT 'Stale accounts (45d+ no activity)' AS \"Metric\",\n       COALESCE((SELECT stale_accounts FROM stale_accounts), 0)::text AS \"Value\",\n       'Accounts without recent transactions' AS \"Detail\"\nUNION ALL\nSELECT 'Unmatched internal transfers',\n       COALESCE((SELECT unmatched_count FROM unmatched_transfers), 0)::text,\n       'Proxy count based on paired in/out amounts'\nUNION ALL\nSELECT 'Uncategorized spend',\n       CONCAT(ROUND(COALESCE((SELECT uncategorized_pct FROM uncategorized), 0), 1)::text, '%'),\n       CONCAT('$', ROUND(COALESCE((SELECT uncategorized_amount FROM uncategorized), 0), 0)::text, ' uncategorized');",
          "refId": "A"
        }
      ],
      "title": "Data Quality Callouts",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Top merchants with uncategorized transactions. Focus categorization efforts here for maximum impact on data quality. Links to transaction detail for quick categorization. Covers the dashboard-selected time window. Click merchant names to view detailed transactions.",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Spend"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Last Seen"
            },
            "properties": [
              {
                "id": "unit",
                "value": "time: YYYY-MM-DD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Contribution %"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "decimals",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Merchant"
            },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "Categorize Merchant",
                    "url": "/d/transaction_analysis_dashboard",
                    "targetBlank": true
                  }
                ]
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 12,
        "y": 43,
        "w": 12,
        "h": 6
      },
      "id": 902,
      "options": {
        "cellHeight": "md",
        "showHeader": true
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH available_months AS (\n  SELECT budget_year_month,\n         to_date(budget_year_month || '-01', 'YYYY-MM-DD') AS month_date\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n),\nlatest_period AS (\n  SELECT MAX(month_date) AS month_date\n  FROM available_months\n),\nbounds AS (\n  SELECT MIN(month_date) AS min_month, MAX(month_date) AS max_month\n  FROM available_months\n),\nselected_period AS (\n  SELECT COALESCE(\n    (SELECT MAX(month_date) FROM available_months WHERE month_date <= date_trunc('month', ($__timeTo()::timestamptz - INTERVAL '1 day'))),\n    (SELECT max_month FROM bounds)\n  ) AS month_date\n),\nwindow_range AS (\n  SELECT\n    GREATEST(date_trunc('day', $__timeFrom()::timestamptz)::date, (SELECT min_month FROM bounds)) AS start_date,\n    LEAST(date_trunc('day', $__timeTo()::timestamptz)::date,   (SELECT max_month FROM bounds)) AS end_date\n),\nwindow_end_day AS (\n  SELECT ((SELECT end_date FROM window_range) + INTERVAL '1 month' - INTERVAL '1 day')::date AS last_day\n),\nfiltered AS (\n  SELECT\n    SPLIT_PART(original_memo, ' - ', 1) AS original_memo,\n    txn_count,\n    total_amount,\n    last_transaction_date\n  FROM reporting.viz_uncategorized_transactions_with_original_memo\n  WHERE last_transaction_date >= (SELECT start_date FROM window_range)\n    AND last_transaction_date <= (SELECT last_day FROM window_end_day)\n),\ntotal_in_window AS (\n  SELECT COALESCE(SUM(total_amount), 0) AS window_total\n  FROM filtered\n),\nranked AS (\n  SELECT\n    f.original_memo AS \"Merchant\",\n    SUM(f.txn_count) AS \"Txn Count\",\n    ROUND(SUM(f.total_amount), 2) AS \"Total Spend\",\n    ROUND(CASE WHEN tw.window_total > 0 THEN (SUM(f.total_amount) / tw.window_total) * 100 ELSE 0 END, 2) AS \"% of Uncategorized\",\n    MAX(f.last_transaction_date) AS \"Last Seen\"\n  FROM filtered f\n  CROSS JOIN total_in_window tw\n  GROUP BY f.original_memo, tw.window_total\n  ORDER BY SUM(f.total_amount) DESC\n  LIMIT 10\n)\nSELECT * FROM ranked\nUNION ALL\nSELECT 'None', 0, 0, 0, NULL::date\nWHERE NOT EXISTS (SELECT 1 FROM ranked);",
          "refId": "A"
        }
      ],
      "title": "Top Uncategorized Merchants",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Monthly spending on family essentials: Groceries, Family & Kids, Health, Household View the Category Spending dashboard for detailed breakdown of essential expenses. Note: Value reflects the selected time range. Set time picker to 'Last Month' for monthly view.",
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "decimals": 0,
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 500
              },
              {
                "color": "orange",
                "value": 1000
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 10,
        "w": 8,
        "h": 4
      },
      "id": 1001,
      "options": {
        "graphMode": "none",
        "colorMode": "background",
        "justifyMode": "center",
        "textMode": "value_and_name",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COALESCE((\n  SELECT total_family_essentials\n  FROM reporting.rpt_family_essentials_compat\n  WHERE budget_year_month = (\n    SELECT MAX(budget_year_month)\n    FROM reporting.rpt_family_essentials_compat\n    WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n  )\n), 0) AS \"Monthly Essentials\";",
          "refId": "A"
        }
      ],
      "title": "Family Essentials",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Months of expenses covered by liquid emergency funds. Target: 6+ months. Critical: <1 month (red), Warning: 1-3 months (orange), Caution: 3-6 months (yellow), Good: 6+ months (green). Based on average monthly essential expenses. [Fixed to latest closed month]",
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 1,
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "dark-red"
              },
              {
                "value": 1,
                "color": "dark-orange"
              },
              {
                "value": 3,
                "color": "dark-yellow"
              },
              {
                "value": 6,
                "color": "dark-green"
              }
            ]
          },
          "custom": {}
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "months_coverage"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Months"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "x": 8,
        "y": 10,
        "w": 8,
        "h": 4
      },
      "id": 1002,
      "options": {
        "graphMode": "none",
        "colorMode": "background",
        "justifyMode": "center",
        "textMode": "value_and_name",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "fields": "",
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 16,
          "valueSize": 80
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH latest AS (\n  SELECT\n    LEAST(months_essential_expenses_covered, 6) AS months_covered,\n    coverage_status AS status\n  FROM reporting.rpt_emergency_fund_coverage\n  ORDER BY report_generated_at DESC NULLS LAST\n  LIMIT 1\n)\nSELECT\n  COALESCE((SELECT months_covered FROM latest), 0) AS \"Months Covered\",\n  COALESCE((SELECT status FROM latest), 'No data available') AS \"Status\";",
          "refId": "A"
        }
      ],
      "title": "Emergency Fund Coverage",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 38,
        "w": 24,
        "h": 5
      },
      "id": 904,
      "options": {
        "cellHeight": "sm",
        "showHeader": true
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH selected_month AS (\n  SELECT MAX(budget_year_month) AS month_key\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n), month_date AS (\n  SELECT to_date(month_key || '-01', 'YYYY-MM-DD') AS month_start\n  FROM selected_month\n), baseline AS (\n  SELECT\n    COALESCE(total_income, 0) AS total_income,\n    COALESCE(total_expenses, 0) AS total_expenses,\n    COALESCE(net_cash_flow, 0) AS net_cash_flow\n  FROM reporting.rpt_monthly_budget_summary\n  WHERE budget_year_month = (SELECT month_key FROM selected_month)\n), essentials AS (\n  SELECT COALESCE(total_family_essentials, 0) AS essentials_spend\n  FROM reporting.rpt_family_essentials_compat\n  WHERE budget_year_month = (SELECT month_key FROM selected_month)\n), uncategorized AS (\n  SELECT COALESCE(SUM(uncategorized_amount), 0) AS uncategorized_amount,\n         COALESCE(SUM(total_outflows), 0) AS total_outflows\n  FROM reporting.rpt_outflows_insights_dashboard_compat\n  WHERE date_trunc('month', period_date)::date = (SELECT month_start FROM month_date)\n), emergency AS (\n  SELECT COALESCE(months_essential_expenses_covered, 0) AS months_covered\n  FROM reporting.rpt_emergency_fund_coverage\n  ORDER BY report_generated_at DESC NULLS LAST\n  LIMIT 1\n), actions AS (\n  SELECT 1 AS priority,\n         'Reduce uncategorized spend to improve tracking accuracy' AS \"Action\",\n         CONCAT(ROUND(CASE WHEN u.total_outflows > 0 THEN (u.uncategorized_amount / u.total_outflows) * 100 ELSE 0 END, 1), '% uncategorized this month') AS \"Why\"\n  FROM uncategorized u\n  WHERE CASE WHEN u.total_outflows > 0 THEN (u.uncategorized_amount / u.total_outflows) * 100 ELSE 0 END >= 10\n\n  UNION ALL\n\n  SELECT 2,\n         'Bring monthly cash flow back to positive territory',\n         CONCAT('Net cash flow is -$', ROUND(ABS(b.net_cash_flow), 0))\n  FROM baseline b\n  WHERE b.net_cash_flow < 0\n\n  UNION ALL\n\n  SELECT 3,\n         'Trim essentials spend ratio under 60% of income',\n         CONCAT('Essentials at ', ROUND(CASE WHEN b.total_income > 0 THEN (e.essentials_spend / b.total_income) * 100 ELSE 0 END, 1), '% of income')\n  FROM baseline b\n  CROSS JOIN essentials e\n  WHERE b.total_income > 0\n    AND (e.essentials_spend / b.total_income) > 0.60\n\n  UNION ALL\n\n  SELECT 4,\n         'Increase emergency buffer contributions',\n         CONCAT('Emergency coverage at ', ROUND(em.months_covered, 1), ' months')\n  FROM emergency em\n  WHERE em.months_covered < 3\n), top_actions AS (\n  SELECT priority AS \"Priority\", \"Action\", \"Why\"\n  FROM actions\n  ORDER BY priority\n  LIMIT 3\n)\nSELECT *\nFROM top_actions\nUNION ALL\nSELECT 99, 'No urgent actions this month', 'All tracked KPIs are within target ranges'\nWHERE NOT EXISTS (SELECT 1 FROM top_actions);",
          "refId": "A"
        }
      ],
      "title": "Top 3 Actions This Month",
      "type": "table"
    }
  ],
  "refresh": "",
  "schemaVersion": 39,
  "style": "dark",
  "tags": [
    "executive",
    "overview",
    "personal-finance",
    "dashboard"
  ],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-1M/M",
    "to": "now/M"
  },
  "timepicker": {
    "hidden": false,
    "quick_ranges": [
      {
        "from": "now-1M/M",
        "to": "now/M",
        "display": "Last complete month"
      },
      {
        "from": "now/Y",
        "to": "now",
        "display": "Year to date"
      },
      {
        "from": "now-12M/M",
        "to": "now/M",
        "display": "Trailing 12 months"
      }
    ]
  },
  "timezone": "",
  "title": "01 - Executive Financial Overview",
  "uid": "executive_dashboard",
  "version": 2,
  "weekStart": ""
}
