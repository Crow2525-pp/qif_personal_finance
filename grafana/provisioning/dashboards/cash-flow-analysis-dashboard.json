{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "text",
        "uid": "-- Text --"
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 100,
      "options": {
        "content": "# ðŸ’° Cash Flow Analysis Dashboard - Financial Health Assessment\n\n**What This Dashboard Shows:** Comprehensive cash flow health with trend-aware metrics and recommendations.\n\n**Key Metrics Explained:**\nâ€¢ **Cash Flow Efficiency Score (1-100):** Overall cash flow health (higher is better).\nâ€¢ **Status Ranking (1-5):** Combined state + trend (1=critical â€¦ 5=excellent).\nâ€¢ **Rolling Averages:** Gauges use the last 3 complete months to avoid one-off spikes.\nâ€¢ **Cash Flow Margin (%):** (Net Cash Flow / Total Inflows) â€” the share of your inflows you retain after outflows. Positive = surplus; <0% = deficit. 10%+ is typically healthy.\nâ€¢ **Outflow-to-Inflow Ratio (%):** (Total Outflows / Total Inflows) â€” how much of your inflows are consumed by spending. Lower is better; >100% indicates overspending.\n\n**Flow Category Definitions**\nâ€¢ **Operating:** Day-to-day household activity â€” salary/wages and core living expenses (Food & Drink, Household & Services, Family & Kids, other routine bills). Operating Cash Flow = operating inflows âˆ’ operating outflows.\nâ€¢ **Financing:** Debt and funding flows â€” mortgage/home-loan repayments, other loan servicing, and internal transfers between your own accounts.\nâ€¢ **Investing:** Buying/selling investments or contributing to investment accounts (e.g., brokerage, super, ETFs). Identified via Investment categories or accounts named with â€˜investâ€™.\n\n**How to Use:** Focus on 3â€‘month gauges for trend, then drill into the latest month and categories. Red indicates persistent stress; look for high outflow-to-inflow ratio and declining trend.",
        "mode": "markdown"
      },
      "pluginVersion": "10.0.0",
      "title": "Dashboard Instructions",
      "type": "text"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "3-month average cash flow efficiency score (1-100), smoothing month-to-month volatility",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [
            {
              "options": {
                "from": 0,
                "result": {
                  "text": "Critical"
                },
                "to": 40
              },
              "type": "range"
            },
            {
              "options": {
                "from": 40,
                "result": {
                  "text": "Poor"
                },
                "to": 50
              },
              "type": "range"
            },
            {
              "options": {
                "from": 50,
                "result": {
                  "text": "Fair"
                },
                "to": 75
              },
              "type": "range"
            },
            {
              "options": {
                "from": 75,
                "result": {
                  "text": "Good"
                },
                "to": 90
              },
              "type": "range"
            },
            {
              "options": {
                "from": 90,
                "result": {
                  "text": "Excellent"
                },
                "to": 100
              },
              "type": "range"
            }
          ],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 50
              },
              {
                "color": "green",
                "value": 75
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 8
      },
      "id": 1,
      "options": {
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH last3 AS (\n  SELECT cash_flow_efficiency_score\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n  ORDER BY transaction_year DESC, transaction_month DESC\n  LIMIT 3\n)\nSELECT ROUND(AVG(cash_flow_efficiency_score)) AS cash_flow_efficiency_score FROM last3;",
          "refId": "A"
        }
      ],
      "title": "Cash Flow Efficiency Score",
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "3-month average status rank (1 worst .. 5 best)",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [
            {
              "options": {
                "1": {
                  "text": "Critical"
                },
                "2": {
                  "text": "Poor" 
                },
                "3": {
                  "text": "Fair"
                },
                "4": {
                  "text": "Good"
                },
                "5": {
                  "text": "Excellent"
                }
              },
              "type": "value"
            }
          ],
          "max": 5,
          "min": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              },
              {
                "color": "orange",
                "value": 2
              },
              {
                "color": "yellow",
                "value": 3
              },
              {
                "color": "light-green",
                "value": 4
              },
              {
                "color": "green",
                "value": 5
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 8
      },
      "id": 2,
      "options": {
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH last3 AS (\n  SELECT cash_flow_status_rank\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n  ORDER BY transaction_year DESC, transaction_month DESC\n  LIMIT 3\n)\nSELECT ROUND(AVG(cash_flow_status_rank)) AS cash_flow_status_rank FROM last3;",
          "refId": "A"
        }
      ],
      "title": "Cash Flow Status Rank",
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "3-month average trend rank (1 Declining, 2 Stable, 3 Improving)",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [
            {
              "options": {
                "1": {
                  "text": "Declining"
                },
                "2": {
                  "text": "Stable"
                },
                "3": {
                  "text": "Improving"
                }
              },
              "type": "value"
            }
          ],
          "max": 3,
          "min": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              },
              {
                "color": "yellow",
                "value": 2
              },
              {
                "color": "green",
                "value": 3
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 12,
        "y": 8
      },
      "id": 9,
      "options": {
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH last3 AS (\n  SELECT CASE \n           WHEN cash_flow_trend = 'Declining' THEN 1\n           WHEN cash_flow_trend = 'Stable' THEN 2\n           WHEN cash_flow_trend = 'Improving' THEN 3\n           ELSE 2\n         END as trend_rank\n  FROM reporting.rpt_cash_flow_analysis\n  WHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n  ORDER BY transaction_year DESC, transaction_month DESC\n  LIMIT 3\n)\nSELECT ROUND(AVG(trend_rank)) AS trend_rank FROM last3;",
          "refId": "A"
        }
      ],
      "title": "Cash Flow Trend",
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "MOST RECENT COMPLETE MONTH: Inflows, outflows, and net cash flow data excludes current incomplete month for accurate analysis. Updated with corrected categorizations.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "total_inflows"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Total Inflows"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "total_outflows"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Total Outflows"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "net_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": -1000
                    },
                    {
                      "color": "green",
                      "value": 0
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 18,
        "y": 8
      },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  total_inflows,\n  total_outflows,\n  net_cash_flow\nFROM reporting.rpt_cash_flow_analysis \nWHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\nORDER BY transaction_year DESC, transaction_month DESC \nLIMIT 1;",
          "refId": "A"
        }
      ],
      "title": "Latest Complete Month Cash Flow",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Monthly cash flow trends over time",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": true,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "net_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Net Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "rolling_3m_avg_net_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "3-Month Average"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "orange",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.drawStyle",
                "value": "line"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [10, 10],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 16
      },
      "id": 4,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  CONCAT(budget_year_month, '-01')::timestamp as time,\n  net_cash_flow,\n  rolling_3m_avg_net_flow\nFROM reporting.rpt_cash_flow_analysis \nWHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n  AND budget_year_month >= TO_CHAR(CURRENT_DATE - INTERVAL '18 months', 'YYYY-MM')\nORDER BY transaction_year, transaction_month;",
          "refId": "A"
        }
      ],
      "title": "Cash Flow Trends",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Breakdown of cash flows by operating, financing, and investing activities",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": true,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "normal"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "operating_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Operating Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "financing_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Financing Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "investing_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Investing Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "purple",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 16
      },
      "id": 5,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  CONCAT(budget_year_month, '-01')::timestamp as time,\n  operating_cash_flow,\n  financing_cash_flow,\n  investing_cash_flow\nFROM reporting.rpt_cash_flow_analysis \nWHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\n  AND budget_year_month >= TO_CHAR(CURRENT_DATE - INTERVAL '18 months', 'YYYY-MM')\nORDER BY transaction_year, transaction_month;",
          "refId": "A"
        }
      ],
      "title": "Cash Flow by Category",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Key cash flow metrics and ratios",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "cash_flow_margin_percent"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Cash Flow Margin"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 5
                    },
                    {
                      "color": "green",
                      "value": 15
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "outflow_to_inflow_ratio"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Outflow to Inflow Ratio"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 80
                    },
                    {
                      "color": "red",
                      "value": 95
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "mom_inflow_change_percent"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "MoM Inflow Change (Last vs Prior)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "mom_outflow_change_percent"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "MoM Outflow Change (Last vs Prior)"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 0,
        "y": 24
      },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  cash_flow_margin_percent,\n  outflow_to_inflow_ratio,\n  mom_inflow_change_percent,\n  mom_outflow_change_percent\nFROM reporting.rpt_cash_flow_analysis \nWHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\nORDER BY transaction_year DESC, transaction_month DESC \nLIMIT 1;",
          "refId": "A"
        }
      ],
      "title": "Cash Flow Metrics",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Year-to-date cash flow progression",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "ytd_inflows"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "YTD Inflows"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ytd_outflows"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "YTD Outflows"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ytd_net_cash_flow"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "YTD Net Cash Flow"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": -5000
                    },
                    {
                      "color": "green",
                      "value": 0
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 24
      },
      "id": 7,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  ytd_inflows,\n  ytd_outflows,\n  ytd_net_cash_flow\nFROM reporting.rpt_cash_flow_analysis \nWHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\nORDER BY transaction_year DESC, transaction_month DESC \nLIMIT 1;",
          "refId": "A"
        }
      ],
      "title": "Year-to-Date Cash Flow",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Month-over-month cash flow changes with summary and links to variance drivers",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Net Flow Change ($)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              },
              {
                "id": "color",
                "value": {
                  "mode": "thresholds"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": -1000
                    },
                    {
                      "color": "green",
                      "value": 0
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 5,
        "w": 12,
        "x": 0,
        "y": 30
      },
      "id": 301,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": ["sum"],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  latest_month as \"Latest Month\",\n  prior_month as \"Prior Month\",\n  ROUND(latest_month_net_flow, 0) as \"Latest Net Flow\",\n  ROUND(prior_month_net_flow, 0) as \"Prior Net Flow\",\n  ROUND(net_flow_change_dollars, 0) as \"Net Flow Change ($)\",\n  net_flow_change_pct as \"Change %\",\n  status_change as \"Status\",\n  change_summary as \"Summary\"\nFROM reporting.rpt_mom_cash_flow_summary;",
          "refId": "A"
        }
      ],
      "title": "What Changed This Month",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Actionable cash flow recommendations linked to specific categories and top drivers",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Top Category Amount"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Primary Income"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 5,
        "w": 12,
        "x": 12,
        "y": 30
      },
      "id": 302,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": ["sum"],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  cash_flow_recommendation as \"Recommendation\",\n  recommendation_driver as \"Action Focus\",\n  top_category_1 as \"Top Category\",\n  ROUND(top_category_1_amount, 0) as \"Top Category Amount\",\n  top_category_1_flag as \"Category Status\",\n  primary_income_source as \"Primary Income\",\n  ROUND(primary_income_amount, 0) as \"Income Amount\"\nFROM reporting.rpt_recommendation_drivers;",
          "refId": "A"
        }
      ],
      "title": "Recommendation Drivers & Action Items",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "Recurring bills projected for next month with due dates and payment priority",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Monthly Cost"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Projected Impact"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Priority"
            },
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "options": {
                      "High": {
                        "color": "red",
                        "index": 0
                      },
                      "Medium": {
                        "color": "yellow",
                        "index": 1
                      },
                      "Low": {
                        "color": "green",
                        "index": 2
                      }
                    },
                    "type": "value"
                  }
                ]
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 6,
        "w": 24,
        "x": 0,
        "y": 35
      },
      "id": 303,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": ["sum"],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": false,
            "displayName": "Days Until Due"
          }
        ]
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  merchant_pattern as \"Merchant/Bill\",\n  category as \"Category\",\n  subcategory as \"Subcategory\",\n  recurrence_type as \"Frequency\",\n  ROUND(estimated_monthly_cost, 2) as \"Monthly Cost\",\n  TO_CHAR(estimated_next_due_date, 'YYYY-MM-DD') as \"Est. Due Date\",\n  days_until_due as \"Days Until Due\",\n  payment_priority as \"Priority\",\n  ROUND(projected_next_month_impact, 2) as \"Projected Impact\",\n  subscription_likelihood_score as \"Confidence %\"\nFROM reporting.rpt_next_month_recurring_bills\nWHERE days_until_due >= 0\nORDER BY days_until_due ASC, estimated_monthly_cost DESC;",
          "refId": "A"
        }
      ],
      "title": "Next Month Recurring Bills & Projected Impact",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "AI-generated cash flow recommendations and insights",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 24,
        "x": 0,
        "y": 41
      },
      "id": 8,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  cash_flow_recommendation as \"Cash Flow Recommendation\",\n  CASE \n    WHEN forecasted_next_month_net_flow > 0 \n    THEN 'Positive: $' || ROUND(forecasted_next_month_net_flow, 0)\n    ELSE 'Negative: $' || ROUND(ABS(forecasted_next_month_net_flow), 0)\n  END as \"Forecasted Next Month\",\n  CASE \n    WHEN days_expenses_covered IS NOT NULL \n    THEN ROUND(days_expenses_covered, 1) || ' days'\n    ELSE 'N/A'\n  END as \"Days Expenses Covered\"\nFROM reporting.rpt_cash_flow_analysis \nWHERE budget_year_month < TO_CHAR(CURRENT_DATE, 'YYYY-MM')\nORDER BY transaction_year DESC, transaction_month DESC \nLIMIT 1;",
          "refId": "A"
        }
      ],
  "title": "Cash Flow Recommendations & Forecast",
  "type": "table"
},
 {
   "datasource": {
     "type": "postgres",
     "uid": "PCC52D03280B7034C"
   },
   "description": "Net, inflow and outflow across the most recent twelve months of available data (internal transfers excluded).",
   "fieldConfig": {
     "defaults": {
       "color": {
         "mode": "palette-classic"
       },
       "custom": {
         "axisCenteredZero": true,
         "axisColorMode": "text",
         "axisLabel": "",
         "axisPlacement": "auto",
         "barAlignment": 0,
         "drawStyle": "line",
         "fillOpacity": 20,
         "gradientMode": "opacity",
         "hideFrom": {
           "legend": false,
           "tooltip": false,
           "vis": false
         },
         "lineInterpolation": "linear",
         "lineWidth": 2,
         "pointSize": 4,
         "scaleDistribution": {
           "type": "linear"
         },
         "showPoints": "auto",
         "spanNulls": false,
         "stacking": {
           "group": "A",
           "mode": "none"
         },
         "thresholdsStyle": {
           "mode": "off"
         }
       },
       "mappings": [],
       "thresholds": {
         "mode": "absolute",
         "steps": [
           {
             "color": "green",
             "value": null
           }
         ]
       },
       "unit": "currencyUSD"
     },
     "overrides": [
       {
         "matcher": {
           "id": "byName",
           "options": "inflow"
         },
         "properties": [
           {
             "id": "displayName",
             "value": "Inflow"
           },
           {
             "id": "color",
             "value": {
               "fixedColor": "#4caf50",
               "mode": "fixed"
             }
           },
           {
             "id": "custom.drawStyle",
             "value": "bars"
           },
           {
             "id": "custom.fillOpacity",
             "value": 80
           }
         ]
       },
       {
         "matcher": {
           "id": "byName",
           "options": "outflow"
         },
         "properties": [
           {
             "id": "displayName",
             "value": "Outflow"
           },
           {
             "id": "color",
             "value": {
               "fixedColor": "#f44336",
               "mode": "fixed"
             }
           },
           {
             "id": "custom.drawStyle",
             "value": "bars"
           },
           {
             "id": "custom.fillOpacity",
             "value": 80
           }
         ]
       },
       {
         "matcher": {
           "id": "byName",
           "options": "net"
         },
         "properties": [
           {
             "id": "displayName",
             "value": "Net"
           },
           {
             "id": "color",
             "value": {
               "fixedColor": "#2196f3",
               "mode": "fixed"
             }
           }
         ]
       }
     ]
   },
   "gridPos": {
     "h": 10,
     "w": 12,
     "x": 0,
     "y": 47
   },
   "id": 210,
   "options": {
     "legend": {
       "calcs": [],
       "displayMode": "list",
       "placement": "bottom",
       "showLegend": true
     },
     "tooltip": {
       "mode": "single",
       "sort": "none"
     }
   },
   "pluginVersion": "10.0.0",
   "targets": [
     {
       "datasource": {
         "type": "postgres",
         "uid": "PCC52D03280B7034C"
       },
       "editorMode": "code",
       "format": "table",
       "rawQuery": true,
       "rawSql": "WITH months AS (\n  SELECT DISTINCT DATE_TRUNC('month', transaction_date)::date AS period_date\n  FROM reporting.fct_transactions_enhanced\n  WHERE COALESCE(is_internal_transfer, false) = false\n), latest AS (\n  SELECT MAX(period_date) AS latest_month FROM months\n), windowed AS (\n  SELECT\n    DATE_TRUNC('month', f.transaction_date)::date AS period_date,\n    SUM(CASE WHEN f.transaction_amount > 0 THEN f.transaction_amount ELSE 0 END) AS inflow,\n    SUM(CASE WHEN f.transaction_amount < 0 THEN f.transaction_amount ELSE 0 END) AS outflow,\n    SUM(f.transaction_amount) AS net\n  FROM reporting.fct_transactions_enhanced f\n  CROSS JOIN latest\n  WHERE COALESCE(f.is_internal_transfer, false) = false\n    AND DATE_TRUNC('month', f.transaction_date)::date BETWEEN (latest_month - INTERVAL '11 months') AND latest_month\n  GROUP BY 1\n)\nSELECT\n  period_date::timestamp AS time,\n  inflow,\n  outflow,\n  net\nFROM windowed\nORDER BY period_date;",
       "refId": "A"
     }
   ],
   "title": "Last 12 Months Cashflow Trend",
   "type": "timeseries"
 },
 {
   "datasource": {
     "type": "postgres",
     "uid": "PCC52D03280B7034C"
   },
   "description": "Account-level inflow, outflow and net position for the latest three months (internal transfers excluded).",
   "fieldConfig": {
     "defaults": {
       "color": {
         "mode": "thresholds"
       },
       "custom": {
         "align": "auto",
         "cellOptions": {
           "type": "auto"
         },
         "inspect": false
       },
       "mappings": [],
       "thresholds": {
         "mode": "absolute",
         "steps": [
           {
             "color": "green",
             "value": null
           }
         ]
       }
     },
     "overrides": []
   },
   "gridPos": {
     "h": 10,
     "w": 12,
     "x": 12,
     "y": 47
   },
   "id": 211,
   "options": {
     "cellHeight": "sm",
     "footer": {
       "countRows": false,
       "fields": "",
       "reducer": [
         "sum"
       ],
       "show": false
     },
     "showHeader": true,
     "sortBy": [
       {
         "desc": true,
         "displayName": "Net"
       }
     ]
   },
   "pluginVersion": "10.0.0",
   "targets": [
     {
       "datasource": {
         "type": "postgres",
         "uid": "PCC52D03280B7034C"
       },
       "editorMode": "code",
       "format": "table",
       "rawQuery": true,
       "rawSql": "WITH monthly AS (\n  SELECT\n    DATE_TRUNC('month', f.transaction_date)::date AS period_date,\n    f.account_key,\n    SUM(CASE WHEN f.transaction_amount > 0 THEN f.transaction_amount ELSE 0 END) AS inflow,\n    SUM(CASE WHEN f.transaction_amount < 0 THEN f.transaction_amount ELSE 0 END) AS outflow,\n    SUM(f.transaction_amount) AS net,\n    COUNT(*) AS transactions\n  FROM reporting.fct_transactions_enhanced f\n  WHERE COALESCE(f.is_internal_transfer, false) = false\n  GROUP BY 1, 2\n), latest AS (\n  SELECT MAX(period_date) AS latest_month FROM monthly\n), windowed AS (\n  SELECT m.*\n  FROM monthly m\n  CROSS JOIN latest\n  WHERE m.period_date BETWEEN (latest_month - INTERVAL '2 months') AND latest_month\n)\nSELECT\n  TO_CHAR(w.period_date, 'YYYY-MM') AS \"Month\",\n  COALESCE(a.bank_name, 'Unknown') AS \"Bank\",\n  COALESCE(REPLACE(a.account_name, '_', ' '), REPLACE(w.account_key, '_', ' ')) AS \"Account\",\n  ROUND(w.inflow, 2) AS \"Inflow\",\n  ROUND(w.outflow, 2) AS \"Outflow\",\n  ROUND(w.net, 2) AS \"Net\",\n  w.transactions AS \"Transactions\"\nFROM windowed w\nLEFT JOIN reporting.dim_accounts_enhanced a ON a.account_key = w.account_key\nORDER BY w.period_date DESC, \"Net\" DESC;",
       "refId": "A"
     }
   ],
   "title": "Last 3 Months Net by Account",
   "type": "table"
 },
 {
  "datasource": {
    "type": "postgres",
    "uid": "PCC52D03280B7034C"
      },
      "description": "**CURRENT MONTH OUTFLOW BREAKDOWN & RISK ANALYSIS**\n\n**What This Shows:** Complete breakdown of spending by category for the most recent complete month.\n\n**Column Definitions:**\nâ€¢ **Current Month ($):** Total amount spent in this category THIS MONTH (sum of all transactions)\nâ€¢ **# Transactions:** Number of individual transactions in this category this month\nâ€¢ **Largest Transaction ($):** Single biggest transaction amount within this category this month\nâ€¢ **% of Total:** This category's share of total monthly outflows\nâ€¢ **% Change vs Historical:** How much this month's total differs from the 6-month average (>100% = significantly above normal)\nâ€¢ **Risk Flag:** Automated assessment based on spending patterns\n\n**Risk Flag Meanings:**\nðŸ”´ **High Uncategorized Spending:** >$500 in uncategorized transactions (needs review)\nðŸ”´ **Significantly Above Historical Average:** >200% of normal spending for this category\nðŸŸ  **Contains Large Transaction:** Includes transaction >$1,000\nðŸŸ¢ **Normal:** Spending within expected ranges\n\n**Example:** If 'Food & Drink' shows $1,065 with 29 transactions, that's $1,065 TOTAL spent across 29 separate purchases this month.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Risk Flag"
            },
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "options": {
                      "High Uncategorized Spending": {
                        "color": "red",
                        "index": 0
                      },
                      "Significantly Above Historical Average": {
                        "color": "orange",
                        "index": 1
                      },
                      "Contains Large Transaction": {
                        "color": "yellow",
                        "index": 2
                      },
                      "Normal": {
                        "color": "green",
                        "index": 3
                      }
                    },
                    "type": "value"
                  }
                ]
              },
              {
                "id": "unit",
                "value": "string"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "% Change vs Historical"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 50
                    },
                    {
                      "color": "orange",
                      "value": 100
                    },
                    {
                      "color": "red",
                      "value": 200
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "% of Total"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "# Transactions"
            },
            "properties": [
              {
                "id": "unit",
                "value": "short"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 57
      },
      "id": 200,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  category as \"Category\",\n  subcategory as \"Subcategory\",\n  current_month_outflows as \"Current Month ($)\",\n  transaction_count as \"# Transactions\",\n  largest_transaction as \"Largest Transaction ($)\",\n  pct_of_total_outflows as \"% of Total\",\n  pct_change_vs_historical as \"% Change vs Historical\",\n  risk_flag as \"Risk Flag\"\nFROM reporting.rpt_current_month_outflow_analysis\nORDER BY current_month_outflows DESC\nLIMIT 15;",
          "refId": "A"
        }
      ],
      "title": "ðŸ’¸ Current Month Outflow Breakdown & Risk Analysis",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "**MONTH-OVER-MONTH VARIANCE ANALYSIS**\n\n**What This Shows:** How spending in each category changed compared to last month and recent trends.\n\n**Column Definitions:**\nâ€¢ **Current Month ($):** Total spent in this category this month (same as above panel)\nâ€¢ **MoM Variance ($):** Dollar change vs last month (positive = spent more, negative = spent less)\nâ€¢ **MoM % Change:** Percentage change vs last month (e.g., +50% = spent 50% more than last month)\nâ€¢ **vs 3-Month Avg ($):** Dollar difference vs rolling 3-month average\nâ€¢ **Spending Flag:** Alert level based on variance patterns\n\n**Spending Flag Meanings:**\nðŸ”´ **High vs Average:** Current month >150% of 3-month rolling average\nðŸŸ  **High vs Prior Month:** Current month >200% of last month\nðŸ”´ **High Uncategorized:** >$1,000 in uncategorized spending\nðŸŸ¢ **Normal:** Spending within normal variance ranges\n\n**How to Read:** If 'Entertainment' shows MoM Variance of +$932 (+458%), you spent $932 MORE this month than last month (458% increase).",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "MoM % Change"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 25
                    },
                    {
                      "color": "orange",
                      "value": 50
                    },
                    {
                      "color": "red",
                      "value": 100
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Spending Flag"
            },
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "options": {
                      "High vs Average": {
                        "color": "red",
                        "index": 0
                      },
                      "High vs Prior Month": {
                        "color": "orange",
                        "index": 1
                      },
                      "High Uncategorized": {
                        "color": "red",
                        "index": 2
                      },
                      "Normal": {
                        "color": "green",
                        "index": 3
                      }
                    },
                    "type": "value"
                  }
                ]
              },
              {
                "id": "unit",
                "value": "string"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 69
      },
      "id": 201,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  category as \"Category\",\n  subcategory as \"Subcategory\",\n  total_outflows as \"Current Month ($)\",\n  mom_variance as \"MoM Variance ($)\",\n  mom_pct_change as \"MoM % Change\",\n  rolling_avg_variance as \"vs 3-Month Avg ($)\",\n  spending_flag as \"Spending Flag\"\nFROM reporting.rpt_cash_flow_drivers_analysis\nWHERE budget_year_month = (SELECT MAX(budget_year_month) FROM reporting.rpt_cash_flow_drivers_analysis)\n  AND total_outflows > 100\nORDER BY ABS(mom_variance) DESC\nLIMIT 12;",
          "refId": "A"
        }
      ],
      "title": "ðŸ“ˆ Month-over-Month Variance Analysis",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "description": "High-risk transactions and spending patterns requiring attention",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Risk Level"
            },
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "options": {
                      "HIGH": {
                        "color": "red",
                        "index": 0
                      },
                      "MEDIUM": {
                        "color": "orange",
                        "index": 1
                      },
                      "LOW": {
                        "color": "yellow",
                        "index": 2
                      }
                    },
                    "type": "value"
                  }
                ]
              },
              {
                "id": "unit",
                "value": "string"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 79
      },
      "id": 202,
      "description": "**Shows monthly spending categories with unusual risk patterns** - All amounts are TOTAL MONTHLY spending by category/subcategory, not individual transactions.\n\n**Risk Level Definitions:**\nâ€¢ **HIGH:** Categories requiring immediate attention (Uncategorized >$500 OR spending >200% of historical average)\nâ€¢ **MEDIUM:** Contains large transactions (>$1000) or single transaction >$1000 total\nâ€¢ **LOW:** Normal variations within expected ranges\n\n**Column Explanations:**\nâ€¢ **Amount ($):** Total monthly outflows for this category (e.g., $225 = spent $225 total in this category this month)\nâ€¢ **Risk Description:** Specific reason for flagging (e.g., 'Significantly Above Historical Average')\nâ€¢ **Details:** Memo from largest transaction in the category for context\n\n**Example:** If 'Zona' shows $225 with HIGH risk, this means you spent $225 total on Zona-related transactions this month, which is significantly higher than your historical monthly average for this category.",
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  category as \"Category\",\n  subcategory as \"Subcategory\",\n  current_month_outflows as \"Amount ($)\",\n  CASE \n    WHEN risk_flag = 'High Uncategorized Spending' THEN 'HIGH'\n    WHEN risk_flag = 'Significantly Above Historical Average' THEN 'HIGH'\n    WHEN risk_flag = 'Contains Large Transaction' THEN 'MEDIUM'\n    WHEN risk_flag = 'Single Large Transaction' THEN 'MEDIUM'\n    ELSE 'LOW'\n  END as \"Risk Level\",\n  risk_flag as \"Risk Description\",\n  largest_transaction_memo as \"Details\"\nFROM reporting.rpt_current_month_outflow_analysis\nWHERE risk_flag != 'Normal'\nORDER BY \n  CASE \n    WHEN risk_flag = 'High Uncategorized Spending' THEN 1\n    WHEN risk_flag = 'Significantly Above Historical Average' THEN 2\n    WHEN risk_flag = 'Contains Large Transaction' THEN 3\n    ELSE 4\n  END,\n  current_month_outflows DESC;",
          "refId": "A"
        }
      ],
      "title": "ðŸš¨ Spending Risk Alerts & Large Transactions",
      "type": "table"
    }
  ],
  "refresh": "",
  "schemaVersion": 39,
  "style": "dark",
  "tags": [
    "cash-flow",
    "analysis",
    "personal-finance",
    "dashboard"
  ],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-1y",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Cash Flow Analysis (Most Recent Complete Month)",
  "uid": "cash_flow_analysis",
  "version": 1,
  "weekStart": ""
}
