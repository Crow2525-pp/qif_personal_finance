{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "Amazon Spending Analysis - 5 Year Overview and Trends",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 4000
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "text": {}
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH amazon_tx AS (\n  SELECT date, amount\n  FROM reporting.reporting__fact_transactions t\n  JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n  WHERE c.store = 'Amazon'\n), ytd AS (\n  SELECT COALESCE(SUM(CASE WHEN amount < 0 THEN -amount ELSE amount END), 0) AS spend\n  FROM amazon_tx\n  WHERE date >= date_trunc('year', CURRENT_DATE)\n)\nSELECT spend AS \"YTD Amazon Spending\" FROM ytd",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "YTD Amazon Spending",
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "displayMode": "basic",
            "orientation": "horizontal"
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "id": 10,
      "options": {
        "reduceOptions": {
          "values": true,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "orientation": "vertical",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH budget_targets AS (\n  SELECT 100 AS monthly_budget_target\n), current_month AS (\n  SELECT \n    SUM(CASE WHEN t.amount < 0 THEN -t.amount ELSE t.amount END) AS monthly_spend,\n    (SELECT monthly_budget_target FROM budget_targets) AS budget_target,\n    COUNT(*) AS transaction_count\n  FROM reporting.reporting__fact_transactions t\n  JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n  WHERE c.store = 'Amazon'\n    AND DATE_TRUNC('month', t.date) = DATE_TRUNC('month', NOW())\n)\nSELECT \n  ROUND(COALESCE(budget_target - monthly_spend, budget_target), 2) AS \"Budget Variance\",\n  ROUND(COALESCE((monthly_spend / budget_target) * 100, 0), 1) AS \"% of Budget\"\nFROM current_month",
          "refId": "A"
        }
      ],
      "title": "Monthly Budget vs Actual",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "displayMode": "basic",
            "orientation": "horizontal"
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "id": 9,
      "options": {
        "reduceOptions": {
          "values": true,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "orientation": "vertical",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT order_count as \"Order Count\", ROUND(average_order_value, 2) as \"Avg Order Value\", ROUND(largest_order_value, 2) as \"Largest Order\" FROM reporting.viz_amazon_order_context ORDER BY year_month DESC LIMIT 1",
          "refId": "A"
        }
      ],
      "title": "Order Context (Latest Month)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "displayMode": "basic",
            "orientation": "horizontal"
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 12,
        "y": 0
      },
      "id": 10,
      "options": {
        "reduceOptions": {
          "values": true,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "orientation": "vertical",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT ROUND(COALESCE(recurring_spend, 0), 2) as \"Recurring Spend\", ROUND(COALESCE(oneoff_spend, 0), 2) as \"One-Off Spend\" FROM reporting.viz_amazon_order_context ORDER BY year_month DESC LIMIT 1",
          "refId": "A"
        }
      ],
      "title": "Recurring vs One-Off (Latest Month)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "displayMode": "basic",
            "orientation": "horizontal"
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 2,
      "options": {
        "displayMode": "basic",
        "maxVizHeight": 300,
        "orientation": "horizontal",
        "reduceOptions": {
          "values": true,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "showUnfilled": true,
        "text": {}
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH amazon_tx AS (\n  SELECT date,\n         CASE WHEN amount < 0 THEN -amount ELSE amount END AS abs_amount\n  FROM reporting.reporting__fact_transactions t\n  JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n  WHERE c.store = 'Amazon'\n)\nSELECT \n  EXTRACT(YEAR FROM date)::int AS \"Year\",\n  SUM(abs_amount) AS \"Total Spending\",\n  COUNT(*) AS \"Transaction Count\",\n  AVG(abs_amount) AS \"Average per Transaction\"\nFROM amazon_tx \nGROUP BY 1\nORDER BY 1 DESC",
          "refId": "A"
        }
      ],
      "title": "Amazon Spending by Year (2020-2025)",
      "type": "bargauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "always",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Transaction Count"
            },
            "properties": [
              {
                "id": "unit",
                "value": "short"
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 8
      },
      "id": 3,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH amazon_tx AS (\n  SELECT date,\n         CASE WHEN amount < 0 THEN -amount ELSE amount END AS abs_amount\n  FROM reporting.reporting__fact_transactions t\n  JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n  WHERE c.store = 'Amazon'\n), monthly AS (\n  SELECT date_trunc('month', date)::date AS month_date,\n         SUM(abs_amount) AS monthly_spending,\n         COUNT(*) AS transaction_count\n  FROM amazon_tx\n  GROUP BY 1\n)\nSELECT month_date AS time,\n       monthly_spending AS \"Monthly Spending\",\n       transaction_count AS \"Transaction Count\"\nFROM monthly\nORDER BY month_date",
          "refId": "A"
        }
      ],
      "title": "Amazon Spending Trends Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "linear",
            "barAlignment": 0,
            "lineWidth": 2,
            "fillOpacity": 10,
            "gradientMode": "none",
            "spanNulls": false,
            "insertNulls": false,
            "showPoints": "auto",
            "pointSize": 5,
            "stacking": {
              "mode": "none",
              "group": "A"
            },
            "axisPlacement": "auto",
            "axisLabel": "Average Order Value",
            "axisColorMode": "text",
            "scaleDistribution": {
              "type": "linear"
            },
            "axisCenteredZero": false,
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "id": 11,
      "options": {
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        },
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "SELECT year_month as time, average_order_value as \"Average Order Value\", previous_month_aov as \"Previous Month AOV\" FROM reporting.viz_amazon_order_context WHERE year_month >= NOW() - INTERVAL '18 months' ORDER BY year_month",
          "refId": "A"
        }
      ],
      "title": "Basket Size Trend (Price Inflation/Volume)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            }
          },
          "mappings": [],
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "id": 4,
      "options": {
        "displayLabels": [
          "name",
          "value"
        ],
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "values": [
            "value"
          ]
        },
        "pieType": "pie",
        "reduceOptions": {
          "values": true,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH amazon_tx AS (\n  SELECT date,\n         CASE WHEN amount < 0 THEN -amount ELSE amount END AS abs_amount\n  FROM reporting.reporting__fact_transactions t\n  JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n  WHERE c.store = 'Amazon'\n)\nSELECT \n  EXTRACT(YEAR FROM date)::int AS \"Year\",\n  SUM(abs_amount) AS \"Total Spending\"\nFROM amazon_tx \nGROUP BY 1\nORDER BY 1 DESC",
          "refId": "A"
        }
      ],
      "title": "Amazon Spending Distribution by Year",
      "type": "piechart"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Spending"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Average per Transaction"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Min Amount"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Max Amount"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Median Amount"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "id": 5,
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Year"
          }
        ]
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH amazon_tx AS (\n  SELECT date,\n         CASE WHEN amount < 0 THEN -amount ELSE amount END AS abs_amount\n  FROM reporting.reporting__fact_transactions t\n  JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n  WHERE c.store = 'Amazon'\n), stats AS (\n  SELECT EXTRACT(YEAR FROM date)::int AS year,\n         abs_amount\n  FROM amazon_tx\n)\nSELECT \n  year AS \"Year\",\n  COUNT(*) AS \"Transaction Count\",\n  SUM(abs_amount) AS \"Total Spending\",\n  AVG(abs_amount) AS \"Average per Transaction\",\n  MIN(abs_amount) AS \"Min Amount\",\n  MAX(abs_amount) AS \"Max Amount\",\n  percentile_cont(0.5) WITHIN GROUP (ORDER BY abs_amount) AS \"Median Amount\"\nFROM stats\nGROUP BY year\nORDER BY year DESC",
          "refId": "A"
        }
      ],
      "title": "Amazon Spending Statistics by Year",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            }
          },
          "mappings": [],
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 24
      },
      "id": 6,
      "options": {
        "displayLabels": [
          "name",
          "value"
        ],
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "values": [
            "value"
          ]
        },
        "pieType": "pie",
        "reduceOptions": {
          "values": true,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  c.subcategory AS \"Amazon Type\",\n  SUM(CASE WHEN t.amount < 0 THEN -t.amount ELSE t.amount END) AS \"Total Spending\"\nFROM reporting.reporting__fact_transactions t\nJOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\nWHERE c.store = 'Amazon'\nGROUP BY c.subcategory\nORDER BY \"Total Spending\" DESC",
          "refId": "A"
        }
      ],
      "title": "Amazon Spending by Type (2020-2025)",
      "type": "piechart"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "vis": false
            }
          },
          "mappings": [],
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 24
      },
      "id": 7,
      "options": {
        "displayLabels": [
          "name",
          "value"
        ],
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "values": [
            "value"
          ]
        },
        "pieType": "pie",
        "reduceOptions": {
          "values": true,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH bucketed AS (\n  SELECT \n    CASE \n      WHEN abs_amount < 20 THEN '<$20'\n      WHEN abs_amount < 50 THEN '$20-49'\n      WHEN abs_amount < 100 THEN '$50-99'\n      WHEN abs_amount < 200 THEN '$100-199'\n      ELSE '$200+'\n    END AS \"Amount Category\",\n    abs_amount\n  FROM (\n    SELECT CASE WHEN t.amount < 0 THEN -t.amount ELSE t.amount END AS abs_amount\n    FROM reporting.reporting__fact_transactions t\n    JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n    WHERE c.store = 'Amazon'\n  ) s\n)\nSELECT \"Amount Category\", SUM(abs_amount) AS \"Total Spending\"\nFROM bucketed\nGROUP BY \"Amount Category\"\nORDER BY MIN(abs_amount)",
          "refId": "A"
        }
      ],
      "title": "Amazon Spending by Amount Category (2020-2025)",
      "type": "piechart"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Amount"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 32
      },
      "id": 8,
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Date"
          }
        ]
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  t.date as \"Date\",\n  t.amount as \"Amount\",\n  c.subcategory as \"Amazon Type\",\n  CASE \n      WHEN ABS(t.amount) < 20 THEN '<$20'\n      WHEN ABS(t.amount) < 50 THEN '$20-49'\n      WHEN ABS(t.amount) < 100 THEN '$50-99'\n      WHEN ABS(t.amount) < 200 THEN '$100-199'\n      ELSE '$200+'\n  END AS \"Amount Category\",\n  t.memo as \"Transaction Description\"\nFROM reporting.reporting__fact_transactions t\nJOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\nWHERE c.store = 'Amazon'\nORDER BY t.date DESC\nLIMIT 50",
          "refId": "A"
        }
      ],
      "title": "Recent Amazon Transactions (2024-2025)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 40
      },
      "id": 11,
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Total Spending"
          }
        ]
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  c.subcategory AS \"Product Category\",\n  COUNT(*) AS \"Transaction Count\",\n  SUM(CASE WHEN t.amount < 0 THEN -t.amount ELSE t.amount END) AS \"Total Spending\",\n  ROUND(AVG(CASE WHEN t.amount < 0 THEN -t.amount ELSE t.amount END), 2) AS \"Avg per Transaction\"\nFROM reporting.reporting__fact_transactions t\nJOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\nWHERE c.store = 'Amazon'\nGROUP BY c.subcategory\nORDER BY \"Total Spending\" DESC\nLIMIT 10",
          "refId": "A"
        }
      ],
      "title": "Top 10 Amazon Product Categories",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PCC52D03280B7034C"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 48
      },
      "id": 12,
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": false,
            "displayName": "Avg Spend"
          }
        ]
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH amazon_stats AS (\n  SELECT \n    ROUND(AVG(CASE WHEN t.amount < 0 THEN -t.amount ELSE t.amount END), 2) AS avg_amazon_spend,\n    SUM(CASE WHEN t.amount < 0 THEN -t.amount ELSE t.amount END) AS total_amazon_spend\n  FROM reporting.reporting__fact_transactions t\n  JOIN reporting.dim_category c ON t.category_foreign_key = c.origin_key\n  WHERE c.store = 'Amazon'\n), online_alternatives AS (\n  SELECT \n    'eBay' AS \"Alternative Retailer\",\n    'Online Marketplace' AS \"Type\",\n    75.00 AS \"Avg Transaction\",\n    0.95 AS \"Competitiveness Score\",\n    5.00 AS \"Est. Avg Savings per Order\"\n  UNION ALL\n  SELECT 'Walmart.com', 'Online Marketplace', 65.00, 0.98, 10.00\n  UNION ALL\n  SELECT 'Target.com', 'Online Marketplace', 60.00, 0.92, 15.00\n  UNION ALL\n  SELECT 'Costco.com', 'Membership Bulk', 120.00, 0.85, 20.00\n  UNION ALL\n  SELECT 'Best Buy Online', 'Electronics', 180.00, 0.90, 5.00\n)\nSELECT \n  \"Alternative Retailer\",\n  \"Type\",\n  \"Avg Transaction\" AS \"Avg Spend\",\n  \"Competitiveness Score\",\n  \"Est. Avg Savings per Order\"\nFROM online_alternatives\nORDER BY \"Competitiveness Score\" DESC",
          "refId": "A"
        }
      ],
      "title": "Switching Opportunity - Alternative Retailers",
      "type": "table"
    }
  ],
  "refresh": "",
  "schemaVersion": 38,
  "style": "dark",
  "tags": [
    "amazon",
    "spending",
    "ecommerce",
    "time_control_rollout:tranche_b",
    "time_control_archetype:historical_windowed"
  ],
  "templating": {
    "list": [
      {
        "name": "time_window",
        "label": "Time Window",
        "type": "custom",
        "hide": 0,
        "current": {
          "text": "Last Complete Month",
          "value": "latest_month",
          "selected": true
        },
        "options": [
          {
            "text": "Last Complete Month",
            "value": "latest_month",
            "selected": true
          },
          {
            "text": "Year to Date",
            "value": "ytd",
            "selected": false
          },
          {
            "text": "Trailing 12 Months",
            "value": "trailing_12m",
            "selected": false
          }
        ],
        "query": "latest_month,ytd,trailing_12m",
        "includeAll": false,
        "multi": false,
        "skipUrlSync": false
      }
    ]
  },
  "time": {
    "from": "now-5y",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Amazon Spending Analysis",
  "uid": "amazon-spending",
  "version": 0,
  "weekStart": ""
}
